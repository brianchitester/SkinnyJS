<!DOCTYPE html>

<html>
<head>
  <title>jquery.modalDialog.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="breakpoints.html">
                breakpoints.js
              </a>
            
              
              <a class="source" href="date-parse.html">
                date-parse.js
              </a>
            
              
              <a class="source" href="jquery.breakpoints.html">
                jquery.breakpoints.js
              </a>
            
              
              <a class="source" href="jquery.calcRestrainedPos.html">
                jquery.calcRestrainedPos.js
              </a>
            
              
              <a class="source" href="jquery.clientRect.html">
                jquery.clientRect.js
              </a>
            
              
              <a class="source" href="jquery.contentSize.html">
                jquery.contentSize.js
              </a>
            
              
              <a class="source" href="jquery.cookies.html">
                jquery.cookies.js
              </a>
            
              
              <a class="source" href="jquery.css.html">
                jquery.css.js
              </a>
            
              
              <a class="source" href="jquery.customEvent.html">
                jquery.customEvent.js
              </a>
            
              
              <a class="source" href="jquery.delimitedString.html">
                jquery.delimitedString.js
              </a>
            
              
              <a class="source" href="jquery.disableEvent.html">
                jquery.disableEvent.js
              </a>
            
              
              <a class="source" href="jquery.hostIframe.html">
                jquery.hostIframe.js
              </a>
            
              
              <a class="source" href="jquery.hoverDelay.html">
                jquery.hoverDelay.js
              </a>
            
              
              <a class="source" href="jquery.htmlEncode.html">
                jquery.htmlEncode.js
              </a>
            
              
              <a class="source" href="jquery.imageSize.html">
                jquery.imageSize.js
              </a>
            
              
              <a class="source" href="jquery.isVisibleKeyCode.html">
                jquery.isVisibleKeyCode.js
              </a>
            
              
              <a class="source" href="jquery.menu.html">
                jquery.menu.js
              </a>
            
              
              <a class="source" href="jquery-menu-exampleskin.html">
                jquery-menu-exampleskin.js
              </a>
            
              
              <a class="source" href="jquery.modalDialog.deviceFixes.html">
                jquery.modalDialog.deviceFixes.js
              </a>
            
              
              <a class="source" href="jquery.modalDialog.getSettings.html">
                jquery.modalDialog.getSettings.js
              </a>
            
              
              <a class="source" href="jquery.modalDialog.header.html">
                jquery.modalDialog.header.js
              </a>
            
              
              <a class="source" href="jquery.modalDialog.history.html">
                jquery.modalDialog.history.js
              </a>
            
              
              <a class="source" href="jquery.modalDialog.html">
                jquery.modalDialog.js
              </a>
            
              
              <a class="source" href="jquery.modalDialog.unobtrusive.html">
                jquery.modalDialog.unobtrusive.js
              </a>
            
              
              <a class="source" href="jquery.modalDialog.userAgent.html">
                jquery.modalDialog.userAgent.js
              </a>
            
              
              <a class="source" href="jquery.modalDialogContent.header.html">
                jquery.modalDialogContent.header.js
              </a>
            
              
              <a class="source" href="jquery.modalDialogContent.html">
                jquery.modalDialogContent.js
              </a>
            
              
              <a class="source" href="jquery.msAjax.html">
                jquery.msAjax.js
              </a>
            
              
              <a class="source" href="jquery.noPageScroll.html">
                jquery.noPageScroll.js
              </a>
            
              
              <a class="source" href="jquery.ns.html">
                jquery.ns.js
              </a>
            
              
              <a class="source" href="jquery.partialLoad.html">
                jquery.partialLoad.js
              </a>
            
              
              <a class="source" href="jquery.postMessage.html">
                jquery.postMessage.js
              </a>
            
              
              <a class="source" href="jquery.proxyAll.html">
                jquery.proxyAll.js
              </a>
            
              
              <a class="source" href="jquery.queryString.html">
                jquery.queryString.js
              </a>
            
              
              <a class="source" href="jquery.richTooltip.html">
                jquery.richTooltip.js
              </a>
            
              
              <a class="source" href="jquery.scrollAnchor.html">
                jquery.scrollAnchor.js
              </a>
            
              
              <a class="source" href="jquery.uncomment.html">
                jquery.uncomment.js
              </a>
            
              
              <a class="source" href="jquery.url.html">
                jquery.url.js
              </a>
            
              
              <a class="source" href="pointy.gestures.html">
                pointy.gestures.js
              </a>
            
              
              <a class="source" href="pointy.html">
                pointy.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>jquery.modalDialog.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">($)</span> </span>{
    <span class="hljs-keyword">if</span> ($.modalDialog &amp;&amp; $.modalDialog._isContent) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Attempt to load jquery.modalDialogContent.js in the same window as jquery.modalDialog.js."</span>);
    }

    <span class="hljs-keyword">var</span> MARGIN = <span class="hljs-number">10</span>; <span class="hljs-comment">// @see MARGIN in jquery.modalDialog.less</span>
    <span class="hljs-keyword">var</span> STARTING_TOP = <span class="hljs-string">"-700px"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>A stack of dialogs in display order</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> _dialogStack = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>A map of dialogs by full ID</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> _fullIdMap = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Default values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $.modalDialog.defaults = {
        zIndex: <span class="hljs-number">10000</span>, <span class="hljs-comment">// Allow callers to participate in zIndex arms races</span>
        title: <span class="hljs-string">""</span>, <span class="hljs-comment">// The title to display in the title bar of the dialog</span>
        maxWidth: <span class="hljs-number">600</span>, <span class="hljs-comment">// Sets the maximum width of the dialog. Note that on small mobile devices, the actual width may be smaller, so you should design the dialog content accordingly</span>
        initialHeight: <span class="hljs-number">100</span>, <span class="hljs-comment">// Only IFrameDialog uses this. Consider this internal for now.</span>
        skin: <span class="hljs-string">"primary"</span>, <span class="hljs-comment">// The name of the skin to use for the dialog</span>
        ajax: <span class="hljs-literal">false</span>, <span class="hljs-comment">// Determines how the url setting is interpreted. If true, the URL is the source for an AJAX dialog. If false, it will be the URL of an IFrame dialog</span>
        url: <span class="hljs-literal">null</span>, <span class="hljs-comment">// The URL for the content of an IFrame or AJAX dialog</span>
        content: <span class="hljs-literal">null</span>, <span class="hljs-comment">// A CSS selector or jQuery object for a content node to use for a node dialog</span>
        destroyOnClose: <span class="hljs-literal">false</span>, <span class="hljs-comment">// If true, the dialog DOM will be destroyed and all events removed when the dialog closes</span>
        containerElement: <span class="hljs-string">"body"</span>, <span class="hljs-comment">// A CSS selector or jQuery object for the element that should be the parent for the dialog DOM (useful for working with jQuery mobile)</span>
        preventEventBubbling: <span class="hljs-literal">true</span>, <span class="hljs-comment">// If true, click and touch events are prevented from bubbling up to the document</span>
        enableHistory: <span class="hljs-literal">true</span>, <span class="hljs-comment">// If the history module is enabled, this can be used to disable history if set false</span>
        onopen: <span class="hljs-literal">null</span>,
        onclose: <span class="hljs-literal">null</span>,
        onbeforeopen: <span class="hljs-literal">null</span>,
        onbeforeclose: <span class="hljs-literal">null</span>,
        onajaxerror: <span class="hljs-literal">null</span>
    };

    <span class="hljs-keyword">var</span> _ua = $.modalDialog._ua;

    $.modalDialog.iframeLoadTimeout = <span class="hljs-number">0</span>;
    $.modalDialog.animationDuration = <span class="hljs-number">600</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Class which creates a jQuery mobile dialog</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> ModalDialog = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(settings)</span> </span>{
        <span class="hljs-keyword">this</span>.settings = settings;
        <span class="hljs-keyword">this</span>.parent = $(<span class="hljs-keyword">this</span>.settings.containerElement || <span class="hljs-string">"body"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Creates event objects on the dialog and copies handlers from settings</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $.each([<span class="hljs-string">"open"</span>, <span class="hljs-string">"beforeopen"</span>, <span class="hljs-string">"close"</span>, <span class="hljs-string">"beforeclose"</span>, <span class="hljs-string">"ajaxerror"</span>], $.proxy(<span class="hljs-keyword">this</span>._setupCustomEvent, <span class="hljs-keyword">this</span>));</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Bind methods called as handlers so “this” works</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $.proxyAll(<span class="hljs-keyword">this</span>, <span class="hljs-string">"_drag"</span>, <span class="hljs-string">"_startDrag"</span>, <span class="hljs-string">"_stopDrag"</span>, <span class="hljs-string">"_close"</span>, <span class="hljs-string">"_keydownHandler"</span>);
    };

    ModalDialog.prototype.dialogType = <span class="hljs-string">"node"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Creates a custom event on this object with the specified event name</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ModalDialog.prototype._setupCustomEvent = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(i, eventName)</span> </span>{
        <span class="hljs-keyword">var</span> onEvent = <span class="hljs-string">"on"</span> + eventName;
        <span class="hljs-keyword">var</span> evt = $.CustomEvent.create(<span class="hljs-keyword">this</span>, eventName);

        <span class="hljs-keyword">var</span> handler = <span class="hljs-keyword">this</span>.settings[onEvent];
        <span class="hljs-keyword">if</span> (handler) {
            evt.add(handler);
        }

        <span class="hljs-keyword">return</span> evt;
    };

    ModalDialog.prototype._initDeferred = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(action, deferred)</span> </span>{
        <span class="hljs-keyword">this</span>._deferreds = <span class="hljs-keyword">this</span>._deferreds || {};
        deferred = deferred || <span class="hljs-keyword">new</span> $.Deferred();
        <span class="hljs-keyword">this</span>._deferreds[action] = deferred;
        <span class="hljs-keyword">return</span> deferred;
    };

    ModalDialog.prototype._completeDeferred = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(action, resolution, args)</span> </span>{
        <span class="hljs-keyword">var</span> deferred = <span class="hljs-keyword">this</span>._deferreds[action];
        <span class="hljs-keyword">if</span> (deferred) {
            deferred[resolution + <span class="hljs-string">"With"</span>](<span class="hljs-keyword">this</span>, args);</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>this._deferreds[action] = null;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
            <span class="hljs-keyword">return</span> deferred;
        }

        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"No deferred initialized for action '"</span> + action + <span class="hljs-string">"'"</span>);
    };

    ModalDialog.prototype._resolveDeferred = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(action, args)</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._completeDeferred(action, <span class="hljs-string">"resolve"</span>, args);
    };

    ModalDialog.prototype._rejectDeferred = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(action, args)</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._completeDeferred(action, <span class="hljs-string">"reject"</span>, args);
    };

    ModalDialog.prototype._clearDeferred = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(action)</span> </span>{
        <span class="hljs-keyword">this</span>._deferreds[action] = <span class="hljs-literal">null</span>;
    };

    ModalDialog.prototype._getDeferred = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(action)</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._deferreds[action];
    };

    ModalDialog.prototype._isDeferredComplete = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(action)</span> </span>{
        <span class="hljs-keyword">var</span> deferred = <span class="hljs-keyword">this</span>._getDeferred(action);
        <span class="hljs-keyword">return</span> !deferred || deferred.state() != <span class="hljs-string">"pending"</span>;
    };

    ModalDialog.prototype.isOpen = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> !!<span class="hljs-keyword">this</span>._open;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Opens the dialog</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ModalDialog.prototype.open = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(disableAnimation)</span> </span>{
        <span class="hljs-keyword">var</span> deferred = <span class="hljs-keyword">this</span>._initDeferred(<span class="hljs-string">"open"</span>, deferred);</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Ensure the dialog doesn’t open once its already opened.. 
Otherwise, you could end up pushing it on to the stack more than once.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._open) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._rejectDeferred(<span class="hljs-string">"open"</span>);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Description</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.level = _dialogStack.length;</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Fire onbeforeopen on this instance</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> evt = <span class="hljs-keyword">this</span>.onbeforeopen.fire();
        <span class="hljs-keyword">if</span> (evt.isDefaultPrevented()) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._rejectDeferred(<span class="hljs-string">"open"</span>);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Fire onbeforeopen globally</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        evt = $.modalDialog.onbeforeopen.fire(<span class="hljs-literal">null</span>, <span class="hljs-keyword">this</span>);
        <span class="hljs-keyword">if</span> (evt.isDefaultPrevented()) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._rejectDeferred(<span class="hljs-string">"open"</span>);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Keep track of the dialog stacking order</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        _dialogStack.push(<span class="hljs-keyword">this</span>);

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.level &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">this</span>.settings.parentId = _dialogStack[<span class="hljs-keyword">this</span>.level - <span class="hljs-number">1</span>].settings._fullId;
        }

        <span class="hljs-keyword">this</span>._open = <span class="hljs-literal">true</span>;

        <span class="hljs-keyword">this</span>._build();</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>add or remove the ‘smallscreen’ class (which can also be checked using CSS media queries)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.$container[$.modalDialog.isSmallScreen() ? <span class="hljs-string">"addClass"</span> : <span class="hljs-string">"removeClass"</span>](<span class="hljs-string">"smallscreen"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Stop any animations on the container</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.$container.stop(<span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>);

        <span class="hljs-keyword">this</span>.$el.show();

        <span class="hljs-keyword">this</span>._showLoadingIndicator();

        $(<span class="hljs-built_in">document</span>).on(<span class="hljs-string">"keydown"</span>, <span class="hljs-keyword">this</span>._keydownHandler);

        <span class="hljs-keyword">this</span>._finishOpenAction = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">if</span> (deferred.state() != <span class="hljs-string">"rejected"</span>) {
                <span class="hljs-keyword">this</span>.$bg.addClass($.modalDialog.veilClass);</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Set the width first so that heights can be calculated based
on the layout for that width.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">var</span> widthData = <span class="hljs-keyword">this</span>._getDefaultWidthData();
                <span class="hljs-keyword">this</span>.$container.css({
                    width: widthData.width
                });

                <span class="hljs-keyword">var</span> initialPos = <span class="hljs-keyword">this</span>._getDefaultPosition();
                <span class="hljs-keyword">var</span> initialTop = initialPos.top;
                initialPos.top = STARTING_TOP; <span class="hljs-comment">// we're going to animate this to slide down</span>
                <span class="hljs-keyword">this</span>.$container.css(initialPos);

                <span class="hljs-keyword">var</span> animationCallback = $.proxy(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                    <span class="hljs-keyword">try</span> {
                        <span class="hljs-keyword">this</span>.$el.addClass(<span class="hljs-string">"dialog-visible"</span>);

                        <span class="hljs-keyword">if</span> ($.modalDialog.isSmallScreen()) {</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>TODO: I question this change. Should it be decoupled from the dialog framework?
It could be put into mobile fixes.
Is this even mobile specific?
Original comment:
Force dialogs that are on small screens to trigger a window resize event when closed, just in case we have resized since the dialog opened.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
                            <span class="hljs-keyword">this</span>.triggerWindowResize = <span class="hljs-literal">false</span>;
                            <span class="hljs-keyword">this</span>._orientationchange = $.proxy(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(event)</span> </span>{
                                    <span class="hljs-keyword">this</span>.triggerWindowResize = <span class="hljs-literal">true</span>;
                                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.pos(event);
                                },
                                <span class="hljs-keyword">this</span>);

                            $(<span class="hljs-built_in">window</span>).on(<span class="hljs-string">"orientationchange resize"</span>, <span class="hljs-keyword">this</span>._orientationchange);
                        }

                        <span class="hljs-keyword">this</span>.onopen.fire();

                        $.modalDialog.onopen.fire(<span class="hljs-literal">null</span>, <span class="hljs-keyword">this</span>);

                        <span class="hljs-keyword">this</span>._resolveDeferred(<span class="hljs-string">"open"</span>);
                    } <span class="hljs-keyword">catch</span> (ex) {
                        <span class="hljs-keyword">this</span>._rejectDeferred(<span class="hljs-string">"open"</span>, ex);
                    }

                    <span class="hljs-keyword">this</span>._clearDeferred(<span class="hljs-string">"open"</span>);

                }, <span class="hljs-keyword">this</span>);

                <span class="hljs-keyword">if</span> (disableAnimation) {</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>If animation is disabled, just move the dialog into position synchronously, 
and then do the callback on the next event loop tick.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">this</span>.$container.css({ top: initialTop });
                    setTimeout(animationCallback, <span class="hljs-number">0</span>);
                } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Otherwise, animate open</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">this</span>.$container.animate({ top: initialTop}, $.modalDialog.animationDuration, <span class="hljs-string">"swing"</span>)
                        .promise()
                        .then(animationCallback, animationCallback);
                }

            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">this</span>._clearDeferred(<span class="hljs-string">"open"</span>);
            }

            <span class="hljs-keyword">this</span>._hideLoadingIndicator();
        };

        <span class="hljs-keyword">this</span>._finishOpen();

        <span class="hljs-keyword">return</span> deferred.promise();
    };

    ModalDialog.prototype._finishOpen = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._finishOpenAction) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">this</span>._finishOpenAction();
            } <span class="hljs-keyword">catch</span> (ex) {
                <span class="hljs-keyword">this</span>._rejectDeferred(<span class="hljs-string">"open"</span>, ex);
                <span class="hljs-keyword">this</span>._clearDeferred(<span class="hljs-string">"open"</span>);
            }

            <span class="hljs-keyword">this</span>._finishOpenAction = <span class="hljs-literal">null</span>;
        }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>If a user hits the ESC key, close the dialog or cancel it’s opening.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ModalDialog.prototype._keydownHandler = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> </span>{
        <span class="hljs-keyword">if</span> (e.keyCode == <span class="hljs-number">27</span>) {
            <span class="hljs-keyword">if</span> ($.modalDialog.getCurrent() === <span class="hljs-keyword">this</span>) {
                <span class="hljs-keyword">this</span>.cancel();
            }
        }
    };

    ModalDialog.prototype.cancel = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Don’t move to the end state of the animation:
stop it right where it is.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$container) {
            <span class="hljs-keyword">this</span>.$container.stop(<span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>);
        }

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isOpen()) {
            <span class="hljs-keyword">this</span>.close();
        }
    };

    ModalDialog.prototype._showLoadingIndicator = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.$loadingIndicator) {
            <span class="hljs-keyword">this</span>.$loadingIndicator = $(<span class="hljs-string">"&lt;div class='dialog-loading-indicator'&gt;&lt;span&gt;&lt;/span&gt;&lt;/div&gt;"</span>)
                .appendTo(<span class="hljs-keyword">this</span>.$bg);</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>.css(“z-index”, parseInt(this.$bg.css(“z-index”), 10) + 1);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        }
    };

    ModalDialog.prototype._hideLoadingIndicator = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">this</span>.$loadingIndicator.remove();
        <span class="hljs-keyword">this</span>.$loadingIndicator = <span class="hljs-literal">null</span>;
    };

    ModalDialog.prototype._popDialogStack = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">if</span> ($.modalDialog.getCurrent() === <span class="hljs-keyword">this</span>) {
            _dialogStack.pop();
        }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Closes the dialog. 
isDialogCloseButton Indicates the cancel button in the dialog’s header was clicked.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ModalDialog.prototype.close = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(isDialogCloseButton)</span> </span>{
        <span class="hljs-keyword">var</span> deferred = <span class="hljs-keyword">this</span>._initDeferred(<span class="hljs-string">"close"</span>, deferred);

        <span class="hljs-keyword">if</span> ($.modalDialog.getCurrent() !== <span class="hljs-keyword">this</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Can't close a dialog that isn't currently displayed on top."</span>);
        }

        <span class="hljs-keyword">var</span> eventSettings = {
            isDialogCloseButton: !! isDialogCloseButton
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Expose an event allowing consumers to cancel the close event</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.onbeforeclose.fire(eventSettings).isDefaultPrevented()) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._rejectDeferred(<span class="hljs-string">"close"</span>);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Expose a global event</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> ($.modalDialog.onbeforeclose.fire(eventSettings, <span class="hljs-keyword">this</span>).isDefaultPrevented()) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._rejectDeferred(<span class="hljs-string">"close"</span>);
        }

        <span class="hljs-keyword">this</span>._popDialogStack();

        $(<span class="hljs-built_in">document</span>).off(<span class="hljs-string">"keydown"</span>, <span class="hljs-keyword">this</span>._keydownHandler);

        <span class="hljs-keyword">this</span>.$el.removeClass(<span class="hljs-string">"dialog-visible"</span>);
        <span class="hljs-keyword">this</span>.$container.animate({
                top: STARTING_TOP
            },
            $.modalDialog.animationDuration,
            <span class="hljs-string">"swing"</span>
        )
            .promise()
            .then(
                $.proxy(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                    <span class="hljs-keyword">try</span> {
                        <span class="hljs-keyword">this</span>._finishClose(eventSettings);
                    } <span class="hljs-keyword">catch</span> (ex) {
                        <span class="hljs-keyword">this</span>._rejectDeferred(<span class="hljs-string">"close"</span>, ex);
                        <span class="hljs-keyword">this</span>._clearDeferred(<span class="hljs-string">"close"</span>);
                    }
                }, <span class="hljs-keyword">this</span>),
                $.proxy(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(ex)</span> </span>{
                    <span class="hljs-keyword">this</span>._rejectDeferred(<span class="hljs-string">"close"</span>, ex);
                    <span class="hljs-keyword">this</span>._clearDeferred(<span class="hljs-string">"close"</span>);
                }, <span class="hljs-keyword">this</span>));</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>unbind global event listeners</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._orientationchange) {
            $(<span class="hljs-built_in">window</span>).off(<span class="hljs-string">"orientationchange resize"</span>, <span class="hljs-keyword">this</span>._orientationchange);
        }

        <span class="hljs-keyword">return</span> deferred.promise();
    };

    ModalDialog.prototype._close = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> </span>{
        e.preventDefault();
        <span class="hljs-keyword">this</span>.close(<span class="hljs-literal">true</span>);
    };

    ModalDialog.prototype._reset = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">this</span>._open = <span class="hljs-literal">false</span>;

        <span class="hljs-keyword">this</span>.$container.stop(<span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>);
        <span class="hljs-keyword">this</span>.$container.css({
            top: STARTING_TOP
        });
        <span class="hljs-keyword">this</span>.$bg.removeClass($.modalDialog.veilClass);
        <span class="hljs-keyword">this</span>.$el.hide();
    };

    ModalDialog.prototype._resetFailed = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">this</span>._reset();
        <span class="hljs-keyword">this</span>._popDialogStack();
    };

    ModalDialog.prototype._finishClose = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> </span>{
        <span class="hljs-keyword">this</span>._reset();

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.settings.destroyOnClose) {
            <span class="hljs-keyword">this</span>._destroy();
        }

        <span class="hljs-keyword">if</span> ($.modalDialog.isSmallScreen() &amp;&amp; <span class="hljs-keyword">this</span>.triggerWindowResize) {
            $(<span class="hljs-built_in">window</span>).trigger(<span class="hljs-string">"resize"</span>);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Fire events on a timeout so that the event loop
has a chance to process DOM changes. 
Without this, close handlers can’t re-open the same iframe dialog:
the iframe isn’t recognized as a new element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        setTimeout(
            $.proxy(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                <span class="hljs-keyword">this</span>.onclose.fire(e);

                $.modalDialog.onclose.fire(e, <span class="hljs-keyword">this</span>);

                <span class="hljs-keyword">this</span>._resolveDeferred(<span class="hljs-string">"close"</span>);
            }, <span class="hljs-keyword">this</span>),
            <span class="hljs-number">0</span>);
    };

    ModalDialog.prototype._destroy = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._destroyed) {
            <span class="hljs-keyword">return</span>;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Put the content node back on the body.
It could be used again.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.$content.detach().appendTo(<span class="hljs-string">"body"</span>);
        <span class="hljs-keyword">this</span>.$el.remove();

        <span class="hljs-keyword">delete</span> _fullIdMap[<span class="hljs-keyword">this</span>.settings._fullId];
        <span class="hljs-keyword">this</span>._destroyed = <span class="hljs-literal">true</span>;
    };

    ModalDialog.prototype._updateZIndexes = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> zIndex = <span class="hljs-keyword">this</span>.settings.zIndex;
        <span class="hljs-keyword">var</span> parent = <span class="hljs-keyword">this</span>.getParent();
        <span class="hljs-keyword">if</span> (parent) {
            zIndex = <span class="hljs-built_in">Math</span>.max(parent.settings.zIndex + <span class="hljs-number">10</span>, zIndex);
        }

        <span class="hljs-keyword">this</span>.$bg.css(<span class="hljs-string">"z-index"</span>, zIndex);
        zIndex += <span class="hljs-number">2</span>;
        <span class="hljs-keyword">this</span>.$container.css(<span class="hljs-string">"z-index"</span>, zIndex);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Builds the DOM for the dialog chrome</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ModalDialog.prototype._build = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">/*jshint quotmark:false*/</span>

        <span class="hljs-keyword">var</span> me = <span class="hljs-keyword">this</span>;

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._destroyed) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"This dialog has been destroyed"</span>);
        }

        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.$el) {
            <span class="hljs-keyword">this</span>.$bg = $(<span class="hljs-string">'&lt;div class="dialog-background"&gt;&lt;/div&gt;'</span>);

            <span class="hljs-keyword">this</span>.$bg.on(<span class="hljs-string">"click mousedown mouseup touchstart touchend"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> </span>{
                <span class="hljs-keyword">if</span> (me.settings.preventEventBubbling) {
                    e.stopPropagation();
                }
            });

            <span class="hljs-keyword">this</span>.$container = $(
                <span class="hljs-string">'&lt;div class="dialog-container" id="'</span> + <span class="hljs-keyword">this</span>.settings._fullId + <span class="hljs-string">'Container"&gt;'</span> +
                <span class="hljs-string">'  &lt;div class="dialog-header"&gt;'</span> +
                <span class="hljs-string">'    &lt;a href="#" class="dialog-close-button"&gt;&lt;span class="dialog-close-button-icon"&gt;&lt;/span&gt;&lt;/a&gt;'</span> +
                <span class="hljs-string">'    &lt;h1&gt;'</span> + (<span class="hljs-keyword">this</span>.settings.title || <span class="hljs-string">""</span>) + <span class="hljs-string">'&lt;/h1&gt;'</span> +
                <span class="hljs-string">'  &lt;/div&gt;'</span> +
                <span class="hljs-string">'  &lt;div class="dialog-content-container"&gt;'</span> +
                <span class="hljs-string">'  &lt;/div&gt;'</span> +
                <span class="hljs-string">'&lt;/div&gt;'</span>
            );

            <span class="hljs-keyword">this</span>.$el = $([<span class="hljs-keyword">this</span>.$bg[<span class="hljs-number">0</span>], <span class="hljs-keyword">this</span>.$container[<span class="hljs-number">0</span>]]).addClass(<span class="hljs-string">"dialog-skin-"</span> + <span class="hljs-keyword">this</span>.settings.skin);</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>HACK: Support jQuery mobile. In jQuery mobile, the root element needs to be specific.
TODO: Move this to a jQuery mobile fixes specific module</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">this</span>.parent.append(<span class="hljs-keyword">this</span>.$bg, <span class="hljs-keyword">this</span>.$container);

            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.parent.is(<span class="hljs-string">"body"</span>) &amp;&amp; !<span class="hljs-keyword">this</span>.parent.hasClass(<span class="hljs-string">"ui-page-active"</span>)) {
                <span class="hljs-keyword">this</span>.$bg.css(<span class="hljs-string">"position"</span>, <span class="hljs-string">"absolute"</span>);

                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.parent.css(<span class="hljs-string">"position"</span>) == <span class="hljs-string">"static"</span>) {
                    <span class="hljs-keyword">this</span>.parent.css(<span class="hljs-string">"position"</span>, <span class="hljs-string">"relative"</span>);
                }
            }

            <span class="hljs-keyword">this</span>.$contentContainer = <span class="hljs-keyword">this</span>.$el.find(<span class="hljs-string">".dialog-content-container"</span>);
            <span class="hljs-keyword">this</span>.$header = <span class="hljs-keyword">this</span>.$el.find(<span class="hljs-string">".dialog-header"</span>);
            <span class="hljs-keyword">this</span>.$closeButton = <span class="hljs-keyword">this</span>.$el.find(<span class="hljs-string">".dialog-close-button"</span>).on(<span class="hljs-string">"click"</span>, <span class="hljs-keyword">this</span>._close);

            <span class="hljs-keyword">this</span>._buildContent();

            <span class="hljs-keyword">this</span>.$contentContainer.on(<span class="hljs-string">"click"</span>, <span class="hljs-string">'*[data-action="close"]'</span>, <span class="hljs-keyword">this</span>._close);

            <span class="hljs-keyword">this</span>.$contentContainer.append(<span class="hljs-keyword">this</span>.$content);</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>only enable dragging if the dialog is over the entire window
and we are not in Internet Explorer 7, because it handles positioning oddly.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">this</span>.parent.is(<span class="hljs-string">"body"</span>) || <span class="hljs-keyword">this</span>.parent.hasClass(<span class="hljs-string">"ui-page-active"</span>)) &amp;&amp; !_ua.ie7) {
                <span class="hljs-keyword">this</span>._makeDraggable();
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">this</span>._alreadyBuilt();
        }

        <span class="hljs-keyword">this</span>._updateZIndexes();
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Subclasses should override to do something when a cached DOM is used</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ModalDialog.prototype._alreadyBuilt = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Two node dialogs can share the same content node (this isn’t true of AJAX or IFRAME dialogs).
Ensure the content node is still owned by this dialog</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$content.parent()[<span class="hljs-number">0</span>] !== <span class="hljs-keyword">this</span>.$contentContainer[<span class="hljs-number">0</span>]) {
            <span class="hljs-keyword">this</span>._buildContent();
            <span class="hljs-keyword">this</span>.$contentContainer.append(<span class="hljs-keyword">this</span>.$content);
        }
    };

    ModalDialog.prototype._getChromeHeight = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>._chromeHeight) {
            <span class="hljs-keyword">this</span>._chromeHeight = <span class="hljs-keyword">this</span>.$container.height() - <span class="hljs-keyword">this</span>.$content.height();
        }

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._chromeHeight;
    };

    ModalDialog.prototype._getDefaultWidthData = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> $win = $(<span class="hljs-built_in">window</span>);
        <span class="hljs-keyword">var</span> windowWidth = <span class="hljs-keyword">this</span>.parent.is(<span class="hljs-string">"body"</span>) ? (<span class="hljs-built_in">window</span>.innerWidth || $win.width()) : <span class="hljs-keyword">this</span>.parent.width();

        <span class="hljs-keyword">return</span> {
            windowWidth: windowWidth,
            width: <span class="hljs-built_in">Math</span>.min(windowWidth - (MARGIN * <span class="hljs-number">2</span>), <span class="hljs-keyword">this</span>.settings.maxWidth)
        };
    };

    ModalDialog.prototype._getDefaultPosition = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(contentHeight)</span> </span>{
        <span class="hljs-keyword">var</span> widthData = <span class="hljs-keyword">this</span>._getDefaultWidthData();
        <span class="hljs-keyword">var</span> scrollTop = $(<span class="hljs-built_in">document</span>).scrollTop();

        <span class="hljs-keyword">var</span> pos = {
            width: widthData.width,
            top: scrollTop + MARGIN
        };

        pos.left = (widthData.windowWidth - pos.width) / <span class="hljs-number">2</span>;

        <span class="hljs-keyword">var</span> isSmallScreen = $.modalDialog.isSmallScreen();

        <span class="hljs-keyword">if</span> (_ua.ie7 || isSmallScreen) <span class="hljs-comment">// TODO why IE7?</span>
        {
            pos.top = MARGIN;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>For small mobile devices, always position at the top.
No need to consider contentHeight.
For larger devices, center vertically.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
        <span class="hljs-keyword">if</span> (!isSmallScreen) {
            contentHeight = contentHeight || <span class="hljs-keyword">this</span>.$content.height();</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Get the new container height with the proposed content height</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> containerHeight = <span class="hljs-keyword">this</span>._getChromeHeight() + contentHeight;

            <span class="hljs-keyword">var</span> parentHeight = <span class="hljs-keyword">this</span>.parent.is(<span class="hljs-string">"body"</span>) ? $(<span class="hljs-built_in">window</span>).height() : <span class="hljs-keyword">this</span>.parent.height();
            <span class="hljs-keyword">var</span> idealTop = ((parentHeight / <span class="hljs-number">2</span>) - (containerHeight / <span class="hljs-number">2</span>)) + scrollTop;

            pos.top = <span class="hljs-built_in">Math</span>.max(idealTop, pos.top);
        }

        <span class="hljs-keyword">return</span> pos;
    };

    ModalDialog.prototype._makeDraggable = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Small devices shouldn’t have the dialog be draggable.
Where you gonna drag to?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
        <span class="hljs-keyword">if</span> ($.modalDialog.isSmallScreen()) {
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-keyword">this</span>.$header.addClass(<span class="hljs-string">"draggable"</span>).on(<span class="hljs-string">"pointerdown"</span>, <span class="hljs-keyword">this</span>._startDrag);
    };

    ModalDialog.prototype._startDrag = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> </span>{
        <span class="hljs-keyword">var</span> $target = $(e.target);</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Don’t drag if the close button is being clicked</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> ($target.is(<span class="hljs-keyword">this</span>.$closeButton) || $target.is(<span class="hljs-keyword">this</span>.$closeButton.children())) {
            <span class="hljs-keyword">return</span>;
        }

        e.stopPropagation();
        e.preventDefault();

        <span class="hljs-keyword">this</span>._initialMousePos = getMousePos(e);
        <span class="hljs-keyword">this</span>._initialDialogPos = <span class="hljs-keyword">this</span>.$container.offset();

        $(<span class="hljs-built_in">document</span>)
            .on(<span class="hljs-string">"pointermove"</span>, <span class="hljs-keyword">this</span>._drag)
            .one(<span class="hljs-string">"pointerup"</span>, <span class="hljs-keyword">this</span>._stopDrag);</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>when there is an iframe and your cursor goes over
the iframe content it stops firing on the parent window</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$frame) {
            <span class="hljs-keyword">this</span>._overlay = $(<span class="hljs-string">"&lt;div class='dialog-content-overlay'&gt;"</span>).appendTo(<span class="hljs-keyword">this</span>.$contentContainer);
        }

        <span class="hljs-keyword">this</span>._isDragging = <span class="hljs-literal">true</span>;
    };

    ModalDialog.prototype._drag = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> </span>{
        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>._isDragging) {
            $(<span class="hljs-built_in">document</span>).off(<span class="hljs-string">"pointermove"</span>, <span class="hljs-keyword">this</span>._drag);
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-keyword">var</span> mousePos = getMousePos(e);

        <span class="hljs-keyword">var</span> deltaTop = mousePos.top - <span class="hljs-keyword">this</span>._initialMousePos.top;
        <span class="hljs-keyword">var</span> deltaLeft = mousePos.left - <span class="hljs-keyword">this</span>._initialMousePos.left;

        <span class="hljs-keyword">var</span> newPos = {
            top: <span class="hljs-keyword">this</span>._initialDialogPos.top + deltaTop,
            left: <span class="hljs-keyword">this</span>._initialDialogPos.left + deltaLeft
        };

        <span class="hljs-keyword">this</span>.$container.css(newPos);
    };

    ModalDialog.prototype._stopDrag = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>._initialMousePos;
        <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>._initialDialogPos;

        $(<span class="hljs-built_in">document</span>).off(<span class="hljs-string">"pointermove"</span>, <span class="hljs-keyword">this</span>._drag);

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._overlay) {
            <span class="hljs-keyword">this</span>._overlay.remove();
            <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>._overlay;
        }

        <span class="hljs-keyword">this</span>._isDragging = <span class="hljs-literal">false</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Gets the current mouse position from the event object.
returns an object with top and left</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> getMousePos = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> </span>{
        <span class="hljs-keyword">var</span> mousePos = {
            left: e.pageX,
            top: e.pageY
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>Translate event positions from a nested iframe</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (e.target.ownerDocument != <span class="hljs-built_in">window</span>.document) {
            <span class="hljs-keyword">var</span> $iframe = $(e.target.ownerDocument).hostIframe();
            <span class="hljs-keyword">if</span> ($iframe.length &gt; <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">var</span> rect = $iframe.clientRect();
                mousePos.top += rect.top;
                mousePos.left += rect.left;
            }
        }

        <span class="hljs-keyword">return</span> mousePos;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Builds the DOM for the content node.
Should be overridden by subclasses.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ModalDialog.prototype._buildContent = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">this</span>.$content = $(<span class="hljs-keyword">this</span>.settings.content);
        <span class="hljs-keyword">this</span>.$content.detach();
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Gets a reference to the current window.
This will be overriden by an iframe dialog.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ModalDialog.prototype.getWindow = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">window</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Gets a reference to the dialog that opened this dialog.
This is null if the dialog was opened by the main window.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ModalDialog.prototype.getParent = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.settings.parentId) {
            <span class="hljs-keyword">return</span> getDialog(<span class="hljs-keyword">this</span>.settings.parentId);
        }

        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>Sets the height of the content in pixels.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ModalDialog.prototype.center = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> pos = <span class="hljs-keyword">this</span>._getDefaultPosition();
        <span class="hljs-keyword">this</span>.$container.animate({
            top: pos.top
        }, <span class="hljs-number">400</span>);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>Reposition the dialog to the correct position.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ModalDialog.prototype.pos = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(animate)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>stop any currently running animations</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.$container.stop(<span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>);

        <span class="hljs-keyword">var</span> pos = <span class="hljs-keyword">this</span>._getDefaultPosition();

        <span class="hljs-keyword">if</span> (animate === <span class="hljs-literal">true</span>) {
            <span class="hljs-keyword">var</span> top = pos.top;
            <span class="hljs-keyword">delete</span> pos.top;
            <span class="hljs-keyword">this</span>.$container.css(pos).animate({
                top: top
            }, <span class="hljs-number">400</span>);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">this</span>.$container.css(pos);
        }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>Sets the title of the dialog in the header.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ModalDialog.prototype.setTitle = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(title)</span> </span>{
        <span class="hljs-keyword">this</span>.$container.find(<span class="hljs-string">".dialog-header h1"</span>).text(title || <span class="hljs-string">""</span>);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>Gets the title of the dialog in the header.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ModalDialog.prototype.getTitle = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.$container.find(<span class="hljs-string">".dialog-header h1"</span>).text();
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>Extends ModalDialog such that the content is an iframe.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> IFrameDialog = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        ModalDialog.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.settings.parentId) {
            <span class="hljs-keyword">this</span>._parentWindow = <span class="hljs-built_in">window</span>.frames[<span class="hljs-keyword">this</span>.settings.parentId];
        }
    };

    $.extend(IFrameDialog.prototype, ModalDialog.prototype);

    IFrameDialog.prototype.dialogType = <span class="hljs-string">"iframe"</span>;

    IFrameDialog.prototype._setupCustomEvent = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> evt = ModalDialog.prototype._setupCustomEvent.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
        evt.add(_crossWindowEventHandler);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>Broadcasts events to all active dialogs so any window that has a proxy for the dialog can be notified.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> _crossWindowEventHandler = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>“this” is the dialog</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; _dialogStack.length; i++) {
            <span class="hljs-keyword">if</span> (_dialogStack[i]._postCommand) {
                _dialogStack[i]._postCommand(<span class="hljs-string">"event"</span> + e.type, $.extend({
                    _eventDialogId: <span class="hljs-keyword">this</span>.settings._fullId
                }, e.data));
            }
        }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>Override the _buildContent method to construct an iframe</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    IFrameDialog.prototype._finishClose = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> </span>{
        ModalDialog.prototype._finishClose.call(<span class="hljs-keyword">this</span>, e);

        <span class="hljs-keyword">this</span>.$frame.remove();
    };

    IFrameDialog.prototype._destroy = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">this</span>.$el.remove();
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>Override the _buildContent method to construct an iframe</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    IFrameDialog.prototype._buildContent = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">/* jshint quotmark:false */</span>

        <span class="hljs-keyword">this</span>._iframeLoadTimer = <span class="hljs-literal">null</span>;

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$frame &amp;&amp; <span class="hljs-keyword">this</span>.$frame.length &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">this</span>.$frame.remove();
        }

        <span class="hljs-keyword">this</span>.$frame = $(<span class="hljs-string">'&lt;iframe src="'</span> + <span class="hljs-keyword">this</span>.settings.url +
            <span class="hljs-string">'" name="'</span> + <span class="hljs-keyword">this</span>.settings._fullId +
            <span class="hljs-string">'" seamless allowtransparency="true" width="100%" style="height:'</span> +
            (<span class="hljs-keyword">this</span>.height || <span class="hljs-keyword">this</span>.settings.initialHeight) + <span class="hljs-string">'px;" class="dialog-frame" scrolling="no" frameborder="0" framespacing="0"&gt;&lt;/iframe&gt;'</span>);

        <span class="hljs-keyword">if</span> ($.modalDialog.iframeLoadTimeout &gt; <span class="hljs-number">0</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>When the iframe loads, even if its a failed status (i.e. 404), the load event will fire.
We expect that the dialog will call notifyReady(). If it doesn’t, this timeout will
eventually fire, causing the open() promise to be rejected, and the dialog state to be cleaned up.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">this</span>.$frame.on(
                <span class="hljs-string">"load"</span>,
                $.proxy(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>The “open” promise has already been resolved: don’t continue setting a timeout.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._isDeferredComplete(<span class="hljs-string">"open"</span>)) {
                            <span class="hljs-keyword">return</span>;
                        }</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>The iframe has $.modalDialog.iframeLoadTimeout milliseconds to call notifyReady() after the load event is called.
Otherwise, the “open” promise will be rejected.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">this</span>._iframeLoadTimer = setTimeout(
                            $.proxy(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._isDeferredComplete(<span class="hljs-string">"open"</span>)) {
                                    <span class="hljs-keyword">return</span>;
                                }

                                <span class="hljs-keyword">this</span>.$frame.remove();
                                <span class="hljs-keyword">this</span>._resetFailed();

                                <span class="hljs-keyword">this</span>._rejectDeferred(<span class="hljs-string">"open"</span>, [{
                                    message: <span class="hljs-string">"iframe load timeout for url: "</span> + <span class="hljs-keyword">this</span>.settings.url
                                }]);

                            }, <span class="hljs-keyword">this</span>),
                            $.modalDialog.iframeLoadTimeout
                        );
                    },
                    <span class="hljs-keyword">this</span>));
        }

        <span class="hljs-keyword">this</span>.$content = <span class="hljs-keyword">this</span>.$frame;
    };

    IFrameDialog.prototype._alreadyBuilt = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">this</span>._buildContent();</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>TODO Need to somehow notify the dialog content that it should fire notifyReady</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.$contentContainer.append(<span class="hljs-keyword">this</span>.$content);
    };

    IFrameDialog.prototype.getWindow = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.$frame.iframeWindow()[<span class="hljs-number">0</span>];
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>Sends a message to the iframe content window. 
Used for orchestrating cross-window communication with dialog proxies.</p>
<ul>
<li>{string} command: The name of the command to send to the content window</li>
<li>{object} data: A simple data object to serialize (as a querystring) and send with the command</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    IFrameDialog.prototype._postCommand = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(command, data)</span> </span>{
        <span class="hljs-keyword">var</span> messageData = {
            dialogCmd: command
        };
        <span class="hljs-keyword">if</span> (data) {
            $.extend(messageData, data);
        }

        <span class="hljs-keyword">var</span> message = $.param(messageData);

        <span class="hljs-keyword">this</span>.postMessage(message);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>Sends a message to the iframe content window. 
Used for orchestrating cross-window communication with dialog proxies.</p>
<ul>
<li>{string} command: The name of the command to send to the content window</li>
<li>{object} data: A simple data object to serialize (as a querystring) and send with the command</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    IFrameDialog.prototype.postMessage = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(message)</span> </span>{
        <span class="hljs-keyword">var</span> win = <span class="hljs-keyword">this</span>.getWindow();

        <span class="hljs-keyword">var</span> hostname = <span class="hljs-keyword">this</span>.frameHostname;
        <span class="hljs-keyword">if</span> (!hostname) {</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>Get the domain of the target window. If the URL is relative, its the same as the current page.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            hostname = <span class="hljs-keyword">this</span>.settings.url.indexOf(<span class="hljs-string">"http"</span>) === <span class="hljs-number">0</span> ? <span class="hljs-keyword">this</span>.settings.url : <span class="hljs-built_in">document</span>.location.href;
        }

        <span class="hljs-keyword">if</span> ($.postMessage) {
            $.postMessage(message, hostname, win);
        } <span class="hljs-keyword">else</span> {
            win.postMessage(message, <span class="hljs-string">"*"</span>);
        }
    };

    IFrameDialog.prototype.setHeight = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(contentHeight, center, skipAnimation)</span> </span>{
        <span class="hljs-keyword">var</span> applyChange = skipAnimation ?
                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">($content, css)</span> </span>{ $content.css(css); } :
                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">($content, css)</span> </span>{ $content.animate(css, { duration: <span class="hljs-number">400</span> }); };

        applyChange(<span class="hljs-keyword">this</span>.$content, {
            height: contentHeight
        });

        <span class="hljs-keyword">if</span> (center) {
            <span class="hljs-keyword">var</span> pos = <span class="hljs-keyword">this</span>._getDefaultPosition(contentHeight);
            applyChange(<span class="hljs-keyword">this</span>.$content, {
                top: pos.top
            });
        }

        <span class="hljs-keyword">this</span>.height = contentHeight;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>Sets the height of the iframe to the detected height of the iframe content document.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    IFrameDialog.prototype.setHeightFromContent = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(center, skipAnimation)</span> </span>{
        <span class="hljs-keyword">this</span>._postCommand(<span class="hljs-string">"setHeightFromContent"</span>, {
            center: !! center,
            skipAnimation: !! skipAnimation
        });
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>Sets the title of the dialog in the header from the HTML title tag of the iframe content document.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    IFrameDialog.prototype.setTitleFromContent = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">this</span>._postCommand(<span class="hljs-string">"setTitleFromContent"</span>);
    };

    IFrameDialog.prototype.notifyReady = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(hostname)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>There may be a timer waiting for the iframe to load- cancel it.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._iframeLoadTimer) {
            clearTimeout(<span class="hljs-keyword">this</span>._iframeLoadTimer);
            <span class="hljs-keyword">this</span>._iframeLoadTimer = <span class="hljs-literal">null</span>;
        }

        <span class="hljs-keyword">this</span>.frameHostname = hostname;

        ModalDialog.prototype._finishOpen.apply(<span class="hljs-keyword">this</span>);
    };

    IFrameDialog.prototype._finishOpen = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{};</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>AjaxDialog: Extends ModalDialog 
Loads content via ajax</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> AjaxDialog = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        ModalDialog.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
    };

    $.extend(AjaxDialog.prototype, ModalDialog.prototype);

    AjaxDialog.prototype.dialogType = <span class="hljs-string">"ajax"</span>;

    AjaxDialog.prototype.open = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> deferred = ModalDialog.prototype.open.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);

        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>._ajaxComplete) {</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>$.fn.partialLoad will ajax in content intelligently,
adding scripts, but not if they’re already loaded.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">this</span>.$content.partialLoad(
                <span class="hljs-keyword">this</span>.settings.url,
                <span class="hljs-literal">null</span>,
                $.proxy(
                    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(responseText, status, xhr)</span> </span>{
                        <span class="hljs-keyword">this</span>._ajaxComplete = <span class="hljs-literal">true</span>;

                        xhr.fail(
                            $.proxy(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                                <span class="hljs-keyword">this</span>._resetFailed();

                                <span class="hljs-keyword">var</span> errEvent = {
                                    xhr: xhr,
                                    status: status,
                                    responseText: responseText
                                };

                                <span class="hljs-keyword">this</span>.onajaxerror.fire(errEvent);

                                <span class="hljs-keyword">this</span>._rejectDeferred(<span class="hljs-string">"open"</span>, [errEvent]);

                            }, <span class="hljs-keyword">this</span>));</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>Extract title from content if not explicitly specified</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">var</span> $title = <span class="hljs-keyword">this</span>.$content.find(<span class="hljs-string">"title"</span>);
                        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.settings.title) {
                            <span class="hljs-keyword">if</span> ($title.length &gt;= <span class="hljs-number">0</span>) {
                                <span class="hljs-keyword">this</span>.setTitle($title.text());
                            }
                        }
                        $title.remove();

                        ModalDialog.prototype._finishOpen.call(<span class="hljs-keyword">this</span>);
                    },
                    <span class="hljs-keyword">this</span>)
            );
        } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>The content is already loaded</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            ModalDialog.prototype._finishOpen.call(<span class="hljs-keyword">this</span>);
        }

        <span class="hljs-keyword">return</span> deferred.promise();
    };

    AjaxDialog.prototype._finishOpen = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>no-op. Needds to wait for content to be ajaxed in asynchronously.
Base implementation will be called manually.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    };

    AjaxDialog.prototype._buildContent = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>Create a container and ajax content into it.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.$content = $(<span class="hljs-string">"&lt;div class='dialog-content'&gt;&lt;/div&gt;"</span>);
    };

    AjaxDialog.prototype._destroy = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">this</span>.$el.remove();
    };

    <span class="hljs-keyword">var</span> _dialogIdCounter = -<span class="hljs-number">1</span>;
    <span class="hljs-keyword">var</span> DIALOG_NAME_PREFIX = <span class="hljs-string">"dialog"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>Determines if the specified string is a CSS selector or a URL.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> isSelector = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(s)</span> </span>{
        <span class="hljs-keyword">var</span> firstChar = s.charAt(<span class="hljs-number">0</span>);
        <span class="hljs-keyword">if</span> (firstChar == <span class="hljs-string">"#"</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>This is a #anchor
Its a selector</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }

        <span class="hljs-keyword">if</span> (s.indexOf(<span class="hljs-string">"/"</span>) &gt;= <span class="hljs-number">0</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>Selectors never contain /
This is a URL</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }

        <span class="hljs-keyword">if</span> (firstChar == <span class="hljs-string">"."</span>) {
            <span class="hljs-keyword">var</span> secondChar = s.charAt(<span class="hljs-number">1</span>);
            <span class="hljs-keyword">if</span> (secondChar == <span class="hljs-string">"."</span> || secondChar == <span class="hljs-string">"/"</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>Starts with .. or ./
This is a URL, not a selector</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>It’s a CSS class:
.foo</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p>We can’t determine. Presume this is a URL.
i.e. “something” or “something.something” can be a either URL or a selector</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>Takes a settings object and calculates derived settings.
Settings go in order:</p>

            </div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <ol>
<li>default value</li>
<li>setting provided on content element</li>
<li>settings passed</li>
</ol>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $.modalDialog._ensureSettings = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(explicitSettings)</span> </span>{
        <span class="hljs-keyword">var</span> settings = $.extend({}, $.modalDialog.defaults);</pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p>An iframe dialog may have sent a reference to dialog content,
but it didn’t know if it was a URL or a selector for a DOM node.
Determine which it is.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (explicitSettings.contentOrUrl) {
            <span class="hljs-keyword">if</span> (isSelector(explicitSettings.contentOrUrl)) {
                explicitSettings.content = $(explicitSettings.contentOrUrl);
            } <span class="hljs-keyword">else</span> {
                explicitSettings.url = explicitSettings.contentOrUrl;
            }

            <span class="hljs-keyword">delete</span> explicitSettings.contentOrUrl;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <p>Read settings specified on the target node’s custom HTML attributes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (explicitSettings.content) {
            <span class="hljs-keyword">var</span> $target = $(explicitSettings.content);
            <span class="hljs-keyword">var</span> targetSettings = $.modalDialog.getSettings($target);
            $.extend(settings, targetSettings);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p>The explicitly specified settings take precedence</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $.extend(settings, explicitSettings);

        <span class="hljs-keyword">var</span> id;</pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <p>A fullId was specified, passed from an existing dialog’s content window via a message. 
Calculate the parentId from the fullId.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (settings._fullId) {
            <span class="hljs-keyword">var</span> idParts = settings._fullId.split(<span class="hljs-string">"_"</span>);
            id = idParts.pop();
            <span class="hljs-keyword">if</span> (idParts.length &gt; <span class="hljs-number">0</span>) {
                settings.parentId = idParts.join(<span class="hljs-string">"_"</span>);
            }
        } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <p>Ensure a unique ID for the dialog</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            id = DIALOG_NAME_PREFIX + (settings.id || ++_dialogIdCounter);</pre></div></div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              <p>If a parentId was specified, this is a new dialog being created from 
a child dialog. The child will become the “parent dialog” of the new dialog.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> parentId = settings.parentId ? settings.parentId + <span class="hljs-string">"_"</span> : <span class="hljs-string">""</span>;

            settings._fullId = parentId + id;
        }

        <span class="hljs-keyword">return</span> settings;
    };

    $.modalDialog._areSettingsEqual = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(a, b)</span> </span>{
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> a) {
            <span class="hljs-keyword">if</span> (key == <span class="hljs-string">"_fullId"</span>) {
                <span class="hljs-keyword">continue</span>;
            }
            <span class="hljs-keyword">var</span> aVal = a[key];
            <span class="hljs-keyword">var</span> bVal = b[key];
            <span class="hljs-keyword">if</span> (aVal !== bVal) {</pre></div></div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <p>Comparison of jQuery objects will
always return false because the object references are different.
Instead, compare the DOM nodes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (aVal.jquery &amp;&amp; bVal.jquery &amp;&amp; aVal[<span class="hljs-number">0</span>] === bVal[<span class="hljs-number">0</span>]) {
                    <span class="hljs-keyword">continue</span>;
                }
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
        }

        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              <p>Gets the dialog by the fullId.</p>

            </div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <ul>
<li>{string} fullId The full ID of the dialog (including all parent ids)</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> getDialog = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(fullId)</span> </span>{
        <span class="hljs-keyword">return</span> _fullIdMap[fullId];
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-89">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-89">&#182;</a>
              </div>
              <p>Public sub-namespace for modal dialogs.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $.modalDialog = $.modalDialog || {};</pre></div></div>
            
        </li>
        
        
        <li id="section-90">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-90">&#182;</a>
              </div>
              <p>Used to prevent the content window script from loading over this one</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $.modalDialog._isHost = <span class="hljs-literal">true</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-91">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-91">&#182;</a>
              </div>
              <p>On small screens we make the background opaque to hide the content because
we will be hiding all content within the DOM and scrolling them to top.
When removing the host window content from the DOM, make the veil opaque to hide it.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $.modalDialog.veilClass = <span class="hljs-string">"dialog-veil"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-92">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-92">&#182;</a>
              </div>
              <p>Creates a new dialog from the specified settings.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $.modalDialog.create = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(settings)</span> </span>{
        settings = $.modalDialog._ensureSettings(settings);

        <span class="hljs-keyword">var</span> dialog = getDialog(settings._fullId);</pre></div></div>
            
        </li>
        
        
        <li id="section-93">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-93">&#182;</a>
              </div>
              <p>Validate that there isn’t an existing dialog open using the same content</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (!dialog &amp;&amp; settings.content) {
            <span class="hljs-keyword">var</span> existingDialog = $(settings.content).modalDialogInstance();

            <span class="hljs-keyword">if</span> (existingDialog &amp;&amp;
                settings._fullId &amp;&amp;
                existingDialog.settings._fullId !== settings._fullId &amp;&amp;
                existingDialog.isOpen()) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"An attempt was made to create a dialog with a content node which is already assigned to another open dialog."</span>);
            }
        }

        <span class="hljs-keyword">if</span> (!dialog) {
            <span class="hljs-keyword">if</span> (settings.url) {
                <span class="hljs-keyword">if</span> (settings.content) {
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Both url and content cannot be specified."</span>);
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (settings.ajax) {
                    dialog = <span class="hljs-keyword">new</span> AjaxDialog(settings);
                } <span class="hljs-keyword">else</span> {
                    dialog = <span class="hljs-keyword">new</span> IFrameDialog(settings);
                }
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (settings.content) {

                <span class="hljs-keyword">var</span> $content = $(settings.content);
                <span class="hljs-keyword">if</span> ($content.length === <span class="hljs-number">0</span>) {
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"ModalDialog content not found"</span>);
                }

                settings.content = $content;

                dialog = <span class="hljs-keyword">new</span> ModalDialog(settings);

                <span class="hljs-keyword">if</span> (!settings.destroyOnClose) {
                    $content.modalDialogInstance(dialog);
                }
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"No url or content node specified"</span>);
            }

            _fullIdMap[settings._fullId] = dialog;
        }

        <span class="hljs-keyword">return</span> dialog;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-94">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-94">&#182;</a>
              </div>
              <p>Gets the currently active dialog (topmost visually).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $.modalDialog.getCurrent = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> _dialogStack.length &gt; <span class="hljs-number">0</span> ? _dialogStack[_dialogStack.length - <span class="hljs-number">1</span>] : <span class="hljs-literal">null</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-95">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-95">&#182;</a>
              </div>
              <p>Gets an existing dialog if it’s settings match the specified setting’s content node or URL</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $.modalDialog.getExisting = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(settings)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-96">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-96">&#182;</a>
              </div>
              <p>Supresses warnings about using !! to coerce a falsy value to boolean</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-comment">/* jshint -W018 */</span>

        <span class="hljs-keyword">var</span> $content = $(settings.content);
        <span class="hljs-keyword">var</span> isMatch;</pre></div></div>
            
        </li>
        
        
        <li id="section-97">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-97">&#182;</a>
              </div>
              <p>Match a node dialog</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> ($content &amp;&amp; $content.length) {
            isMatch = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(existingSettings)</span> </span>{
                <span class="hljs-keyword">return</span> existingSettings.content &amp;&amp;
                    $(existingSettings.content)[<span class="hljs-number">0</span>] === $content[<span class="hljs-number">0</span>];
            };
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-98">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-98">&#182;</a>
              </div>
              <p>match an iframe or ajax dialog</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (settings.url) {
            isMatch = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(existingSettings)</span> </span>{
                <span class="hljs-keyword">return</span> existingSettings.url &amp;&amp;
                    existingSettings.url === settings.url &amp;&amp; !! existingSettings.ajax === !! settings.ajax;
            };
        }

        <span class="hljs-keyword">if</span> (isMatch) {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> _fullIdMap) {
                <span class="hljs-keyword">var</span> dialog = _fullIdMap[key];
                <span class="hljs-keyword">if</span> (isMatch(dialog.settings)) {
                    <span class="hljs-keyword">return</span> dialog;
                }
            }
        }

        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-99">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-99">&#182;</a>
              </div>
              <p>Global events (not associated with an instance)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $.CustomEvent.create($.modalDialog, <span class="hljs-string">"beforeopen"</span>);
    $.CustomEvent.create($.modalDialog, <span class="hljs-string">"open"</span>);
    $.CustomEvent.create($.modalDialog, <span class="hljs-string">"beforeclose"</span>);
    $.CustomEvent.create($.modalDialog, <span class="hljs-string">"close"</span>);

    <span class="hljs-keyword">var</span> JQUERY_DATA_KEY = <span class="hljs-string">"modalDialog"</span>;

    $.fn.modalDialogInstance = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(dialog)</span> </span>{
        <span class="hljs-keyword">return</span> !dialog ? <span class="hljs-keyword">this</span>.data(JQUERY_DATA_KEY) : <span class="hljs-keyword">this</span>.data(JQUERY_DATA_KEY, dialog);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-100">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-100">&#182;</a>
              </div>
              <p>Idiomatic jQuery interface for node dialogs.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $.fn.modalDialog = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(settings)</span> </span>{
        <span class="hljs-keyword">var</span> dialog;</pre></div></div>
            
        </li>
        
        
        <li id="section-101">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-101">&#182;</a>
              </div>
              <p>If the first argument is a string, it is a method name to call on the dialog
associated with the DOM element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> settings == <span class="hljs-string">"string"</span>) {
            <span class="hljs-keyword">var</span> action = settings;
            dialog = <span class="hljs-keyword">this</span>.modalDialogInstance();
            <span class="hljs-keyword">if</span> (dialog &amp;&amp; dialog[action]) {
                dialog[action].apply(dialog, <span class="hljs-built_in">Array</span>.prototype.slice(<span class="hljs-built_in">arguments</span>, <span class="hljs-number">1</span>));
            }
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-102">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-102">&#182;</a>
              </div>
              <p>Otherwise, create a new dialog.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">else</span> {
            settings = settings || {};
            settings.content = <span class="hljs-keyword">this</span>[<span class="hljs-number">0</span>];

            dialog = $.modalDialog.create(settings);

            dialog.open();
        }

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-103">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-103">&#182;</a>
              </div>
              <p>A map of actions that can be passed as the “dialogCmd” argument in posted messages from IFrameDialog dialog proxies.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> messageActions = {
        setHeight: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(dialog, qs)</span> </span>{
            dialog.setHeight(<span class="hljs-built_in">parseInt</span>(qs.height, <span class="hljs-number">10</span>), qs.center === <span class="hljs-string">"true"</span>, qs.skipAnimation === <span class="hljs-string">"true"</span>);
        },

        setTitle: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(dialog, qs)</span> </span>{
            dialog.setTitle(qs.title);
        },

        open: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(dialog)</span> </span>{
            dialog.open();
        },

        close: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(dialog)</span> </span>{
            dialog.close();
        },

        create: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-104">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-104">&#182;</a>
              </div>
              <p>do nothing- the dialog was created already</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        },

        center: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(dialog)</span> </span>{
            dialog.center();
        },

        notifyReady: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(dialog, qs)</span> </span>{
            dialog.notifyReady(qs.hostname);
        }
    };

    <span class="hljs-keyword">var</span> messageHandler = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> </span>{
        <span class="hljs-keyword">var</span> qs;

        <span class="hljs-keyword">try</span> {
            qs = $.deparam(e.originalEvent ? e.originalEvent.data : e.data);
        } <span class="hljs-keyword">catch</span> (ex) {</pre></div></div>
            
        </li>
        
        
        <li id="section-105">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-105">&#182;</a>
              </div>
              <p>ignore- it wasn’t a message for the dialog framework</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        }</pre></div></div>
            
        </li>
        
        
        <li id="section-106">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-106">&#182;</a>
              </div>
              <p>messages in the dialog framework contain “dialogCmd”</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (qs &amp;&amp; qs.dialogCmd) {
            <span class="hljs-keyword">var</span> action = messageActions[qs.dialogCmd];
            <span class="hljs-keyword">if</span> (action) {
                <span class="hljs-keyword">var</span> dialog;

                <span class="hljs-keyword">if</span> (qs._fullId) {</pre></div></div>
            
        </li>
        
        
        <li id="section-107">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-107">&#182;</a>
              </div>
              <p>If a fullId is passed, it can be either for a new dialog or an existing dialog.
$.modalDialog.create() handles both cases.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    dialog = $.modalDialog.create(qs);
                } <span class="hljs-keyword">else</span> {
                    dialog = $.modalDialog.getCurrent();
                }

                action(dialog, qs);

                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
        }

        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-108">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-108">&#182;</a>
              </div>
              <p>Note: It is a bit odd that even though we have the jquery.postMessage() plugin,
we’re still checking its availability and calling the native implementation here.
The reason is that for most browsers (besides old IE) the plugin is unnecessary, 
and it may not be desirable to load it at all.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
    <span class="hljs-keyword">if</span> ($.receiveMessage) {
        $.receiveMessage(messageHandler, <span class="hljs-string">"*"</span>);
    } <span class="hljs-keyword">else</span> {
        $(<span class="hljs-built_in">window</span>).on(<span class="hljs-string">"message"</span>, messageHandler);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-109">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-109">&#182;</a>
              </div>
              <p>Global hook to simplify non-cross domain communication</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-built_in">window</span>._dialogReceiveMessageManual = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(message, origin)</span> </span>{
        <span class="hljs-keyword">if</span> (!messageHandler({
            data: message,
            origin: origin
        })) {
            <span class="hljs-keyword">var</span> evt = <span class="hljs-keyword">new</span> $.Event(<span class="hljs-string">"message"</span>);
            evt.data = message;
            evt.origin = origin;
            $(<span class="hljs-built_in">window</span>).trigger(evt, [message, origin]);
        }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-110">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-110">&#182;</a>
              </div>
              <p>jQuery mobile support</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $(<span class="hljs-built_in">document</span>).ready(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">if</span> (!$.mobile) {
            <span class="hljs-keyword">return</span>;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-111">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-111">&#182;</a>
              </div>
              <p>Alternate defaults when jQuery mobile is loaded. Work around JQM’s quirks.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $.modalDialog.defaults = $.extend(
            $.modalDialog.defaults, {</pre></div></div>
            
        </li>
        
        
        <li id="section-112">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-112">&#182;</a>
              </div>
              <p>JQM widgets must be in the active data-role=”page” element to work
containerElement: “.ui-page.ui-page-active”,</p>

            </div>
            
        </li>
        
        
        <li id="section-113">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-113">&#182;</a>
              </div>
              <p>Event bubbling breaks many JQM widgets</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                preventEventBubbling: <span class="hljs-literal">false</span>
            });
    });

})(jQuery);</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>

<!DOCTYPE html>

<html>
<head>
  <title>jquery.menu.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="breakpoints.html">
                breakpoints.js
              </a>
            
              
              <a class="source" href="date-parse.html">
                date-parse.js
              </a>
            
              
              <a class="source" href="jquery.breakpoints.html">
                jquery.breakpoints.js
              </a>
            
              
              <a class="source" href="jquery.calcRestrainedPos.html">
                jquery.calcRestrainedPos.js
              </a>
            
              
              <a class="source" href="jquery.clientRect.html">
                jquery.clientRect.js
              </a>
            
              
              <a class="source" href="jquery.contentSize.html">
                jquery.contentSize.js
              </a>
            
              
              <a class="source" href="jquery.cookies.html">
                jquery.cookies.js
              </a>
            
              
              <a class="source" href="jquery.css.html">
                jquery.css.js
              </a>
            
              
              <a class="source" href="jquery.customEvent.html">
                jquery.customEvent.js
              </a>
            
              
              <a class="source" href="jquery.delimitedString.html">
                jquery.delimitedString.js
              </a>
            
              
              <a class="source" href="jquery.disableEvent.html">
                jquery.disableEvent.js
              </a>
            
              
              <a class="source" href="jquery.hostIframe.html">
                jquery.hostIframe.js
              </a>
            
              
              <a class="source" href="jquery.hoverDelay.html">
                jquery.hoverDelay.js
              </a>
            
              
              <a class="source" href="jquery.htmlEncode.html">
                jquery.htmlEncode.js
              </a>
            
              
              <a class="source" href="jquery.imageSize.html">
                jquery.imageSize.js
              </a>
            
              
              <a class="source" href="jquery.isVisibleKeyCode.html">
                jquery.isVisibleKeyCode.js
              </a>
            
              
              <a class="source" href="jquery.menu.html">
                jquery.menu.js
              </a>
            
              
              <a class="source" href="jquery-menu-exampleskin.html">
                jquery-menu-exampleskin.js
              </a>
            
              
              <a class="source" href="jquery.modalDialog.deviceFixes.html">
                jquery.modalDialog.deviceFixes.js
              </a>
            
              
              <a class="source" href="jquery.modalDialog.getSettings.html">
                jquery.modalDialog.getSettings.js
              </a>
            
              
              <a class="source" href="jquery.modalDialog.header.html">
                jquery.modalDialog.header.js
              </a>
            
              
              <a class="source" href="jquery.modalDialog.history.html">
                jquery.modalDialog.history.js
              </a>
            
              
              <a class="source" href="jquery.modalDialog.html">
                jquery.modalDialog.js
              </a>
            
              
              <a class="source" href="jquery.modalDialog.unobtrusive.html">
                jquery.modalDialog.unobtrusive.js
              </a>
            
              
              <a class="source" href="jquery.modalDialog.userAgent.html">
                jquery.modalDialog.userAgent.js
              </a>
            
              
              <a class="source" href="jquery.modalDialogContent.header.html">
                jquery.modalDialogContent.header.js
              </a>
            
              
              <a class="source" href="jquery.modalDialogContent.html">
                jquery.modalDialogContent.js
              </a>
            
              
              <a class="source" href="jquery.msAjax.html">
                jquery.msAjax.js
              </a>
            
              
              <a class="source" href="jquery.noPageScroll.html">
                jquery.noPageScroll.js
              </a>
            
              
              <a class="source" href="jquery.ns.html">
                jquery.ns.js
              </a>
            
              
              <a class="source" href="jquery.partialLoad.html">
                jquery.partialLoad.js
              </a>
            
              
              <a class="source" href="jquery.postMessage.html">
                jquery.postMessage.js
              </a>
            
              
              <a class="source" href="jquery.proxyAll.html">
                jquery.proxyAll.js
              </a>
            
              
              <a class="source" href="jquery.queryString.html">
                jquery.queryString.js
              </a>
            
              
              <a class="source" href="jquery.richTooltip.html">
                jquery.richTooltip.js
              </a>
            
              
              <a class="source" href="jquery.scrollAnchor.html">
                jquery.scrollAnchor.js
              </a>
            
              
              <a class="source" href="jquery.uncomment.html">
                jquery.uncomment.js
              </a>
            
              
              <a class="source" href="jquery.url.html">
                jquery.url.js
              </a>
            
              
              <a class="source" href="pointy.gestures.html">
                pointy.gestures.js
              </a>
            
              
              <a class="source" href="pointy.html">
                pointy.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>jquery.menu.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>/ <reference path="jquery.hoverDelay.js" />
/ <reference path="pointy.js" />
/ <reference path="pointy.gestures.js" />
TODO: Support modifying state in the future by storing an object using $.data(), implement $(selector).dropDownMenu(“option”, value);
TODO: Accessibility: Keyboard navigation (tab navigation already works)- close submenus on pressing enter (maybe)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">($)</span> </span>{
    <span class="hljs-keyword">var</span> _skins = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Register skins by name for rendering the menu.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $.registerDropDownMenuSkin = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(name, skin)</span> </span>{
        _skins[name] = skin;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Hover highlighting</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">highlightMenuItem</span><span class="hljs-params">($item, enabled)</span> </span>{
        <span class="hljs-keyword">var</span> classToAdd = enabled ? <span class="hljs-string">"hover"</span> : <span class="hljs-string">"nohover"</span>;
        <span class="hljs-keyword">var</span> classToRemove = enabled ? <span class="hljs-string">"nohover"</span> : <span class="hljs-string">"hover"</span>;

        <span class="hljs-keyword">if</span> (!$item.hasClass(classToAdd)) {
            $item.addClass(classToAdd).removeClass(classToRemove);
        }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>TODO: It would be nice to have a jQuery.findUntil(selector)
This is a simple substitute. Recurse until the an element is found
with the specified class, and then stop searching in that node.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">findUntilInternal</span><span class="hljs-params">(elem, fnIsMatch, results)</span> </span>{
        <span class="hljs-keyword">if</span> (elem.nodeType !== <span class="hljs-number">1</span>) {
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-keyword">if</span> (fnIsMatch.call(elem, elem, results) === <span class="hljs-literal">false</span>) {
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, len = elem.childNodes.length; i &lt; len; i++) {
            findUntilInternal(elem.childNodes[i], fnIsMatch, results);
        }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>jQuery wrapper</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">findUntil</span><span class="hljs-params">($elem, fnIsMatch)</span> </span>{
        <span class="hljs-keyword">var</span> results = [];

        $elem.each(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
            findUntilInternal(<span class="hljs-keyword">this</span>, fnIsMatch, results);
        });

        <span class="hljs-keyword">return</span> $(results);
    }

    <span class="hljs-keyword">var</span> _defaults = {</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>When true, the top level menu opens on mouseover (instead of on click, which is the default).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        showOnHover: <span class="hljs-literal">true</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>When true, and showOnHover is enabled, clicking an A tag within a menu item that contains a submenu will be allowed to navigate
NOTE: This option is ignored when showOnHover is false.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        linksWithSubmenusEnabled: <span class="hljs-literal">false</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Event which fires when a menu item is selected.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        selected: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Event which fires before a menu panel is show. Can be used to prevent the panel from showing.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        beforeShowPanel: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Event which fires before a menu panel is hidden. Can be used to prevent the panel from hiding.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        beforeHidePanel: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Event which fires after a panel is shown.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        showPanelComplete: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Event which fires after a panel is hidden.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        hidePanelComplete: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Event which fires on show allowing you to override the animation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        animationShow: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Event which fires on hide allowing you to override the animation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        animationHide: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Event which allows overriding the positioning of a panel when it is shown. 
This is defined by the skin by default, but can be overridden for any instance of the menu.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        position: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>The predefined skin to use for rendering this instance</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        skin: <span class="hljs-string">"basic"</span>
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Dropdown menu plugin. The jQuery element collection should include
top-level container elements which in turn contain items with class “menu-item”.
Each item in the jQuery collection becomes a menu “group”.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $.fn.dropDownMenu = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(options)</span> </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.length === <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Map skin from the registered skin collection</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> _skin = _skins[options.skin];
        <span class="hljs-keyword">if</span> (!_skin) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Invalid dropDownMenu skin: "</span> + options.skin);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Merge explicit options with skin and defaults</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> _options = $.extend({}, _defaults, _skin || {}, options);</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Resolve conflicting options</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (!_options.showOnHover) {
            _options.linksWithSubmenusEnabled = <span class="hljs-literal">false</span>;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Creates a menu “group” from a jQuery collection of top-level
menu items. This will be called once for each element in the
top level jQuery object’s collection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createMenuFromTopMenuItems</span><span class="hljs-params">($topLevelItems)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Assign a CSS class to help distinguish between top-level
and sub menus.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            $topLevelItems.addClass(<span class="hljs-string">"menu-item-top"</span>);

            <span class="hljs-keyword">var</span> _panels = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>The menu panel heirarchy root element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> _rootMenu = {
                parent: <span class="hljs-literal">null</span>,
                children: []
            };</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>When a top menu button is clicked, the menu
begins to react to hover events (mimics Windows/MacOS menus).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> _clickHoverActivated = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Used to signal the document click handler that 
the click came from the menu, so it should be ignored.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> _ignoreDocumentClick = <span class="hljs-literal">false</span>;

            <span class="hljs-keyword">var</span> Panel = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Panel</span><span class="hljs-params">($panel, $item)</span> </span>{
                <span class="hljs-keyword">var</span> me = <span class="hljs-keyword">this</span>;

                <span class="hljs-keyword">this</span>.$panel = $panel;
                <span class="hljs-keyword">this</span>.$item = $item || $panel.closest(<span class="hljs-string">".menu-item"</span>);
                <span class="hljs-keyword">this</span>.$parentPanel = <span class="hljs-keyword">this</span>.$item.closest(<span class="hljs-string">".menu-panel"</span>);
                <span class="hljs-keyword">this</span>.isTopLevel = <span class="hljs-keyword">this</span>.$parentPanel.length === <span class="hljs-number">0</span>;

                <span class="hljs-keyword">this</span>.parent = <span class="hljs-literal">null</span>;
                <span class="hljs-keyword">this</span>.children = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Indicates the Panel is open (expanded)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">this</span>.isOpen = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Indicates that the panel is in the middle of showing/hiding</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">this</span>.transitioning = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Store a reference to this instance from the DOM element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.$panel) {
                    <span class="hljs-keyword">this</span>.$panel.data(<span class="hljs-string">"PanelInstance"</span>, <span class="hljs-keyword">this</span>);
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Bind event handlers to DOM elements</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">init</span><span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Assign a special class to distinguish menu items with a submenu from those without one.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    me.$item.addClass(<span class="hljs-string">"menu-item-with-submenu"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Bind the special “press” event, when an item is tapped we determine what to do.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    me.$item.on({
                        <span class="hljs-string">"press"</span>: toggleClick,
                        <span class="hljs-string">"click"</span>: preventClickSometimes
                    });</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>setup pointer hover events only when the option is enabled</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (_options.showOnHover) {</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Set up event handlers to control submenus appearing on hover</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        me.$item.hoverDelay(showOnPointerOver, hideOnPointerOut, {
                            delayOver: me.isTopLevel &amp;&amp; !_options.showOnHover ? <span class="hljs-number">0</span> : <span class="hljs-number">200</span>,
                            delayOut: <span class="hljs-number">500</span>
                        });
                    }</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Top menu items have different rules for rollovers (mimics Windows/MacOS menus)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (me.isTopLevel) {
                        me.$item.on(<span class="hljs-string">"pointerout"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> </span>{
                            <span class="hljs-keyword">if</span> (!me.isOpen) {</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Prevent mouseouts when rolling over tags within the same menu item.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                <span class="hljs-keyword">if</span> (e.relatedTarget) {
                                    <span class="hljs-keyword">if</span> ($(<span class="hljs-keyword">this</span>).has(e.relatedTarget).length &gt; <span class="hljs-number">0</span> &amp;&amp; !$(<span class="hljs-keyword">this</span>).is(e.relatedTarget)) {
                                        <span class="hljs-keyword">return</span>;
                                    }
                                }

                                highlight(<span class="hljs-literal">false</span>);
                            }
                        });
                    }</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Note: It is legitimate to have a Panel object without a submenu.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (me.$panel) {</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Event handler for clicking on panels.
Handles firing the “selected” event.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        me.$panel.click(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Find the parent menu item of the clicked element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            <span class="hljs-keyword">var</span> $clickedMenuItem = $(e.target).closest(<span class="hljs-string">".menu-item"</span>, me.$panel);

                            <span class="hljs-keyword">if</span> ($clickedMenuItem) {</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>If the menu item has a submenu, then it shouldn’t
fire selected- it just opens the submenu.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                <span class="hljs-keyword">if</span> (!$clickedMenuItem.hasClass(<span class="hljs-string">"menu-item-with-submenu"</span>)) {
                                    <span class="hljs-keyword">var</span> ev = getEvent(e);
                                    ev.$selectedItem = $clickedMenuItem;
                                    ev.selectedItem = $clickedMenuItem[<span class="hljs-number">0</span>];

                                    <span class="hljs-keyword">if</span> (_options.selected) {
                                        _options.selected.call(<span class="hljs-keyword">this</span>, ev);
                                    }</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Give the event handler a chance to cancel the event.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                    <span class="hljs-keyword">if</span> (ev.cancel) {
                                        e.stopPropagation();
                                        <span class="hljs-keyword">return</span>;
                                    }</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>If this is a click on a leaf node, and the window is navigating, don’t hide the menu.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                    <span class="hljs-keyword">if</span> (!e.isDefaultPrevented()) {
                                        <span class="hljs-keyword">return</span>;
                                    }</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>The clicked element was a menu item with no sub-menu: hide.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                    hideAllClick(e);
                                }
                            }

                            e.stopPropagation();
                        });</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Ensure a tags within a menu item with a submenu get disabled
This flag setting allows the menu to make sub menu items
only open/close the submenu, and prevent navigation with clicks
Note: That on touch events, these sub menu links always cause
the sub menu to toggle.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">if</span> (!_options.linksWithSubmenusEnabled) {
                            getLinksWithSubmenus().on(<span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(event)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>prevent the navigation behavior</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                event.preventDefault();</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>stop propagation to prevent this click from going to
document and elements beneath this menu item</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                event.stopPropagation();
                            });
                        }
                    }
                }

                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getLinksWithSubmenus</span><span class="hljs-params">()</span> </span>{
                    <span class="hljs-keyword">return</span> findUntil(me.$item, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(elem, results)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>Stop searching once we get to the nested panel.
We’re only interested in A tags owned by this specific
menu item.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">if</span> ($(elem).hasClass(<span class="hljs-string">"menu-panel"</span>)) {
                            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                        }</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>Add links found to the results</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">if</span> (elem.tagName == <span class="hljs-string">"A"</span>) {
                            results.push(elem);
                        }

                        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                    });
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Resolves the .parent property and adds this Panel
to the parent’s children property.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">this</span>.resolveParent = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">resolveParent</span><span class="hljs-params">()</span> </span>{
                    me.parent = me.$parentPanel.data(<span class="hljs-string">"PanelInstance"</span>) || _rootMenu;
                    me.parent.children.push(me);
                };

                <span class="hljs-keyword">var</span> _level = <span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>Gets the level of the Panel in the heirarchy. 0 is the root menu item.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">this</span>.getLevel = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getLevel</span><span class="hljs-params">()</span> </span>{
                    <span class="hljs-keyword">if</span> (_level === <span class="hljs-literal">null</span>) {
                        _level = -<span class="hljs-number">1</span>; <span class="hljs-comment">// Account for _rootMenu: first level menu should be level 0</span>
                        <span class="hljs-keyword">var</span> current = me.parent;
                        <span class="hljs-keyword">while</span> (current) {
                            current = current.parent;
                            _level++;
                        }
                    }

                    <span class="hljs-keyword">return</span> _level;
                };

                <span class="hljs-keyword">var</span> _siblings;</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>Gets an array of the siblings of this Panel (Panels with the same parent)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">this</span>.getSiblings = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getSiblings</span><span class="hljs-params">()</span> </span>{
                    <span class="hljs-keyword">if</span> (!_siblings) {
                        _siblings = [];
                        <span class="hljs-keyword">if</span> (me.parent) {
                            $.each(me.parent.children, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span> !== me) {
                                    _siblings.push(<span class="hljs-keyword">this</span>);
                                }
                            });
                        }
                    }

                    <span class="hljs-keyword">return</span> _siblings;
                };</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>TODO use a jQuery event
Creates a new “fake” event for passing to event handlers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getEvent</span><span class="hljs-params">(e)</span> </span>{
                    <span class="hljs-keyword">return</span> {
                        $panel: me.$panel,
                        panel: me,
                        $parentPanel: me.$parentPanel,
                        parentPanel: me.$parentPanel[<span class="hljs-number">0</span>],
                        $item: me.$item,
                        item: me.$item[<span class="hljs-number">0</span>],
                        level: me.getLevel(),
                        innerEvent: e,
                        preventDefault: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                            <span class="hljs-keyword">this</span>.cancel = <span class="hljs-literal">true</span>;
                        }
                    };
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>Adds/removes the “hover” class. Allows callers to 
define their own rollover states.
Note: We cant use CSS hover pseudo-classes because the rules
for Windows/MacOS style menus don’t follow the same rules.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">highlight</span><span class="hljs-params">(enabled)</span> </span>{
                    highlightMenuItem(me.$item, enabled);
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>Determines if the current menu should show on hover (in addition to click)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">shouldShowSubmenuOnHover</span><span class="hljs-params">()</span> </span>{
                    <span class="hljs-keyword">if</span> (!me.isTopLevel) {
                        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                    }</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>If this is the top menu, only react to a mouseover event
if we’re in “hover mode” (there has already been a click),
or if we’re in the “always on” hover mode.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">return</span> _clickHoverActivated || _options.showOnHover;
                }

                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">showOnPointerOver</span><span class="hljs-params">(e)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>In Windows/MacOS, top level menus highlight instantly, with no delay</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (me.isTopLevel) {
                        highlight(<span class="hljs-literal">true</span>);
                    }

                    <span class="hljs-keyword">if</span> (!shouldShowSubmenuOnHover()) {
                        <span class="hljs-keyword">return</span>;
                    }

                    me.show(e);
                }

                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hideOnPointerOut</span><span class="hljs-params">(e)</span> </span>{
                    <span class="hljs-keyword">if</span> (me.isTopLevel &amp;&amp; !_options.showOnHover) {
                        <span class="hljs-keyword">return</span>;
                    }

                    <span class="hljs-keyword">if</span> (!shouldShowSubmenuOnHover()) {
                        <span class="hljs-keyword">return</span>;
                    }

                    me.hide(e);
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>Shows the panel</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">this</span>.show = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">show</span><span class="hljs-params">(e)</span> </span>{
                    <span class="hljs-keyword">if</span> (me.transitioning || me.isOpen) {
                        <span class="hljs-keyword">return</span>;
                    }

                    <span class="hljs-keyword">var</span> ev;

                    <span class="hljs-keyword">if</span> (me.$panel) {
                        ev = getEvent(e);

                        <span class="hljs-keyword">if</span> (_options.beforeShowPanel) {
                            _options.beforeShowPanel.call(me, ev);
                        }</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>Give the handler a chance to cancel the event</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">if</span> (ev.cancel) {
                            <span class="hljs-keyword">return</span>;
                        }
                    }</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>Ensure that all siblings are hidden</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    $.each(me.getSiblings(), <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                        <span class="hljs-keyword">this</span>.hide(e);
                    });

                    hideOtherMenus(e);</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>Ensure the current menu item is highlighted</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    highlight(<span class="hljs-literal">true</span>);

                    <span class="hljs-keyword">if</span> (!me.$panel) {
                        <span class="hljs-keyword">return</span>;
                    }

                    me.transitioning = <span class="hljs-literal">true</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>Hook for positioning strategies</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    ev = getEvent(e);</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>Fire the position event provided by the skin or options
to calculate positioning for the menu</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (_options.position) {
                        _options.position(ev);
                    }</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>if we have a hook to override the animation we use</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (_options.animationShow) {
                        _options.animationShow.call(me, ev, showComplete);
                    } <span class="hljs-keyword">else</span> {
                        $panel.show();
                        showComplete();
                    }
                };

                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">showComplete</span><span class="hljs-params">(e)</span> </span>{
                    me.isOpen = <span class="hljs-literal">true</span>;
                    me.transitioning = <span class="hljs-literal">false</span>;

                    <span class="hljs-keyword">if</span> (_options.showPanelComplete) {
                        _options.showPanelComplete.call(me, getEvent(e));
                    }
                }

                <span class="hljs-keyword">this</span>.hide = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hide</span><span class="hljs-params">(e)</span> </span>{
                    <span class="hljs-keyword">if</span> (!me.isOpen || me.transitioning) {
                        <span class="hljs-keyword">return</span>;
                    }

                    <span class="hljs-keyword">if</span> (me.$panel) {
                        <span class="hljs-keyword">var</span> ev = getEvent(e);

                        <span class="hljs-keyword">if</span> (_options.beforeHidePanel) {
                            _options.beforeHidePanel.call(me, ev);
                        }</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>Give the handler a chance to cancel the event</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">if</span> (ev.cancel) {
                            <span class="hljs-keyword">return</span>;
                        }
                    }

                    highlight(<span class="hljs-literal">false</span>);

                    <span class="hljs-keyword">if</span> (!me.$panel) {
                        <span class="hljs-keyword">return</span>;
                    }

                    me.transitioning = <span class="hljs-literal">true</span>;

                    $.each(me.children, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                        <span class="hljs-keyword">this</span>.hide(e);
                    });

                    <span class="hljs-keyword">if</span> (_options.animationHide) {
                        _options.animationHide.call(me, getEvent(e), hideComplete);
                    } <span class="hljs-keyword">else</span> {
                        $panel.hide();
                        hideComplete();
                    }
                };

                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hideComplete</span><span class="hljs-params">(e)</span> </span>{
                    me.isOpen = <span class="hljs-literal">false</span>;
                    me.transitioning = <span class="hljs-literal">false</span>;

                    <span class="hljs-keyword">if</span> (_options.hidePanelComplete) {
                        _options.hidePanelComplete.call(me, getEvent(e));
                    }
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>signal to prevent the next click, set during a touch event
to prevent the click, because you cannot cancel the
native “click” event reliably outside of the “click” event
itself</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">var</span> _shouldPreventNextClick = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>Sometimes, we need to prevent the native click event
it’s sad, but this is the best implementation I’ve created</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">preventClickSometimes</span><span class="hljs-params">(e)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>we stop propagation to prevent this click from
going to the document handler to close all menus
this also prevents the clicks from going through
to items below the menu</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    e.stopPropagation();

                    <span class="hljs-keyword">if</span> (_shouldPreventNextClick) {</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>compare the time difference, we only listen to this
prevention if it’s within 200ms of the original
event to prevent errors</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">var</span> timeDiff = +(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()) - _shouldPreventNextClick;</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>reset the trigger</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        _shouldPreventNextClick = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>if the time difference is less than 1000ms (1s)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">if</span> (timeDiff &lt; <span class="hljs-number">1000</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>prevent default to prevent navigation (possibly)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            e.preventDefault();
                        }
                    }
                }

                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">toggleClick</span><span class="hljs-params">(e)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>we always want to stop the propagation to parent elements,
this can cause the inner leaf items to close sub menus,
or close the menus if it reaches the root document or
just cause double-trigger if the target was the <a> when the
handler is on the <li></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    e.stopPropagation();</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>if this is a mouse click, we do not want to interrupt normal navigation
if there is no panel it should act like a regular link, always.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (!me.$panel || e.pointerType == <span class="hljs-string">"mouse"</span>) {
                        <span class="hljs-keyword">return</span>;
                    }</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>determine if this event has bubbled</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (me.$panel.length &gt; <span class="hljs-number">0</span>) {
                        <span class="hljs-keyword">var</span> $closestPanel = $(e.target).closest(<span class="hljs-string">".menu-panel"</span>);
                        <span class="hljs-keyword">if</span> ($closestPanel.length &gt; <span class="hljs-number">0</span> &amp;&amp; $closestPanel[<span class="hljs-number">0</span>] === me.$panel[<span class="hljs-number">0</span>]) {
                            _shouldPreventNextClick = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>This event bubbled from a child panel’s link (a leaf menu item).
It doesn’t have a Panel object of its own, so it should act like a regular link.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            <span class="hljs-keyword">return</span>;
                        }
                    }</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>For touch events that aren’t from leaf menu items,
cancel the default event so touching the menu doesn’t cause navigation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    _shouldPreventNextClick = +(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>());
                    e.preventDefault();

                    <span class="hljs-keyword">if</span> (me.transitioning) {
                        <span class="hljs-keyword">return</span>;
                    }

                    me[me.isOpen ? <span class="hljs-string">"hideClick"</span> : <span class="hljs-string">"showClick"</span>](e);

                    <span class="hljs-keyword">if</span> (me.isTopLevel) {
                        _ignoreDocumentClick = +(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>());
                    }
                }

                <span class="hljs-keyword">this</span>.showClick = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> </span>{
                    <span class="hljs-keyword">if</span> (me.isTopLevel) {
                        _clickHoverActivated = <span class="hljs-literal">true</span>;
                    }

                    me.show(e);
                };

                <span class="hljs-keyword">this</span>.hideClick = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> </span>{
                    <span class="hljs-keyword">if</span> (me.isTopLevel) {
                        _clickHoverActivated = <span class="hljs-literal">false</span>;
                    }

                    me.hide(e);
                };

                <span class="hljs-keyword">this</span>.hideForce = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> </span>{
                    _clickHoverActivated = <span class="hljs-literal">false</span>;
                    me.hide(e);
                };

                init.apply(<span class="hljs-keyword">this</span>);
            };</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>Hides all menus and submenus</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hideAllClick</span><span class="hljs-params">(e)</span> </span>{
                _ignoreDocumentClick = +(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>());

                $.each(_rootMenu.children, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                    <span class="hljs-keyword">this</span>.hideForce(e);
                });
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p>Handler for a document click to close all menus</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">documentClickHandler</span><span class="hljs-params">(e)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>Check a flag which indicates the click is from the menu itself</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (_ignoreDocumentClick) {</pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <p>store the time difference, we only listen to this
prevention if it’s within 200ms of the original
event to prevent errors</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">var</span> timeDiff = +(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()) - _ignoreDocumentClick;

                    _ignoreDocumentClick = <span class="hljs-literal">false</span>;

                    <span class="hljs-keyword">if</span> (timeDiff &lt; <span class="hljs-number">200</span>) {
                        <span class="hljs-keyword">return</span>;
                    }
                }

                hideAllClick(e);
            }

            _allCloseHandlers.push(hideAllClick);

            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hideOtherMenus</span><span class="hljs-params">(e)</span> </span>{
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; _allCloseHandlers.length; i++) {
                    <span class="hljs-keyword">if</span> (_allCloseHandlers[i] !== hideAllClick) {
                        _allCloseHandlers[i](e);
                    }
                }
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p>Create a Panel instance for each menu panel, store in an array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            $topLevelItems.find(<span class="hljs-string">".menu-panel"</span>).each(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                _panels.push(<span class="hljs-keyword">new</span> Panel($(<span class="hljs-keyword">this</span>)));
            });</pre></div></div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <p>Top level items without a submenu need a Panel instance as well, to interact with other top level items.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            $topLevelItems.not(<span class="hljs-string">".menu-item-with-submenu"</span>).each(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                _panels.push(<span class="hljs-keyword">new</span> Panel(<span class="hljs-literal">null</span>, $(<span class="hljs-keyword">this</span>)));
            });</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p>Build a tree representing the parent/child relationships in the menu</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            $.each(_panels, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                <span class="hljs-keyword">this</span>.resolveParent();
            });</pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <p>Set up rollovers on the menu items.
Note: This does not include the top level items with submenus, which have different
rules for rollovers. jQuery.find() only includes decendants, no the current set,
which is the top level menu items.</p>
<p>we use hoverDelay because it internally filters out touch-based pointer events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            $topLevelItems.find(<span class="hljs-string">".menu-item"</span>).hoverDelay(
                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                    highlightMenuItem($(<span class="hljs-keyword">this</span>), <span class="hljs-literal">true</span>);
                },
                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                    highlightMenuItem($(<span class="hljs-keyword">this</span>), <span class="hljs-literal">false</span>);
                })
                .each(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                    highlightMenuItem($(<span class="hljs-keyword">this</span>), <span class="hljs-literal">false</span>);
                });</pre></div></div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <p>Bind a handler to close the menu if it is clicked off.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            $(<span class="hljs-built_in">document</span>).on(<span class="hljs-string">"click"</span>, documentClickHandler);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              <p>Loop through each menu container and create a menu “group”.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.each(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <p>Find all the top-level menu items within the container.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> $topLevelItems = findUntil($(<span class="hljs-keyword">this</span>), <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(elem, results)</span> </span>{
                <span class="hljs-keyword">if</span> ($(elem).hasClass(<span class="hljs-string">"menu-item"</span>)) {
                    results.push(elem);
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                }

                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            });</pre></div></div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              <p>Invoke the create menu function with a jQuery object
containing all the top level menu items.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            createMenuFromTopMenuItems($topLevelItems);
        });</pre></div></div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <p>Allow the jQuery chain to remain unbroken.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };

    <span class="hljs-keyword">var</span> _allCloseHandlers = [];

})(jQuery);</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>

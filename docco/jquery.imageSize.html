<!DOCTYPE html>

<html>
<head>
  <title>jquery.imageSize.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="breakpoints.html">
                breakpoints.js
              </a>
            
              
              <a class="source" href="date-parse.html">
                date-parse.js
              </a>
            
              
              <a class="source" href="jquery.breakpoints.html">
                jquery.breakpoints.js
              </a>
            
              
              <a class="source" href="jquery.calcRestrainedPos.html">
                jquery.calcRestrainedPos.js
              </a>
            
              
              <a class="source" href="jquery.clientRect.html">
                jquery.clientRect.js
              </a>
            
              
              <a class="source" href="jquery.contentSize.html">
                jquery.contentSize.js
              </a>
            
              
              <a class="source" href="jquery.cookies.html">
                jquery.cookies.js
              </a>
            
              
              <a class="source" href="jquery.css.html">
                jquery.css.js
              </a>
            
              
              <a class="source" href="jquery.customEvent.html">
                jquery.customEvent.js
              </a>
            
              
              <a class="source" href="jquery.delimitedString.html">
                jquery.delimitedString.js
              </a>
            
              
              <a class="source" href="jquery.disableEvent.html">
                jquery.disableEvent.js
              </a>
            
              
              <a class="source" href="jquery.hostIframe.html">
                jquery.hostIframe.js
              </a>
            
              
              <a class="source" href="jquery.hoverDelay.html">
                jquery.hoverDelay.js
              </a>
            
              
              <a class="source" href="jquery.htmlEncode.html">
                jquery.htmlEncode.js
              </a>
            
              
              <a class="source" href="jquery.imageSize.html">
                jquery.imageSize.js
              </a>
            
              
              <a class="source" href="jquery.isVisibleKeyCode.html">
                jquery.isVisibleKeyCode.js
              </a>
            
              
              <a class="source" href="jquery.menu.html">
                jquery.menu.js
              </a>
            
              
              <a class="source" href="jquery-menu-exampleskin.html">
                jquery-menu-exampleskin.js
              </a>
            
              
              <a class="source" href="jquery.modalDialog.deviceFixes.html">
                jquery.modalDialog.deviceFixes.js
              </a>
            
              
              <a class="source" href="jquery.modalDialog.getSettings.html">
                jquery.modalDialog.getSettings.js
              </a>
            
              
              <a class="source" href="jquery.modalDialog.header.html">
                jquery.modalDialog.header.js
              </a>
            
              
              <a class="source" href="jquery.modalDialog.history.html">
                jquery.modalDialog.history.js
              </a>
            
              
              <a class="source" href="jquery.modalDialog.html">
                jquery.modalDialog.js
              </a>
            
              
              <a class="source" href="jquery.modalDialog.unobtrusive.html">
                jquery.modalDialog.unobtrusive.js
              </a>
            
              
              <a class="source" href="jquery.modalDialog.userAgent.html">
                jquery.modalDialog.userAgent.js
              </a>
            
              
              <a class="source" href="jquery.modalDialogContent.header.html">
                jquery.modalDialogContent.header.js
              </a>
            
              
              <a class="source" href="jquery.modalDialogContent.html">
                jquery.modalDialogContent.js
              </a>
            
              
              <a class="source" href="jquery.msAjax.html">
                jquery.msAjax.js
              </a>
            
              
              <a class="source" href="jquery.noPageScroll.html">
                jquery.noPageScroll.js
              </a>
            
              
              <a class="source" href="jquery.ns.html">
                jquery.ns.js
              </a>
            
              
              <a class="source" href="jquery.partialLoad.html">
                jquery.partialLoad.js
              </a>
            
              
              <a class="source" href="jquery.postMessage.html">
                jquery.postMessage.js
              </a>
            
              
              <a class="source" href="jquery.proxyAll.html">
                jquery.proxyAll.js
              </a>
            
              
              <a class="source" href="jquery.queryString.html">
                jquery.queryString.js
              </a>
            
              
              <a class="source" href="jquery.richTooltip.html">
                jquery.richTooltip.js
              </a>
            
              
              <a class="source" href="jquery.scrollAnchor.html">
                jquery.scrollAnchor.js
              </a>
            
              
              <a class="source" href="jquery.uncomment.html">
                jquery.uncomment.js
              </a>
            
              
              <a class="source" href="jquery.url.html">
                jquery.url.js
              </a>
            
              
              <a class="source" href="pointy.gestures.html">
                pointy.gestures.js
              </a>
            
              
              <a class="source" href="pointy.html">
                pointy.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>jquery.imageSize.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">($)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Scales and positions an image so that it totally fills the container specified by the “closestSelector”,
it crops, rather than stretches, the image. The container should have overflow:hidden.
@param {String} src The URL of the image to load
@param {Object} closestSelector jQuery selector to determine the container to fill
@param {Function} callback Optional callback once image has been resized</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $.fn.fillClosest = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(src, closestSelector, callback)</span> </span>{
        <span class="hljs-keyword">this</span>.each(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">var</span> img = <span class="hljs-keyword">this</span>;

            <span class="hljs-keyword">var</span> callbackWrapper = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(size)</span> </span>{
                <span class="hljs-keyword">var</span> css = fillClosest.call(img, size, closestSelector);
                $(img).css(css);

                <span class="hljs-keyword">if</span> (callback) {
                    callback.call(img, size);
                }
            };

            $.naturalSize(src, callbackWrapper);
        });

        <span class="hljs-keyword">this</span>.attr(<span class="hljs-string">"src"</span>, src);

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };

    <span class="hljs-keyword">var</span> fillClosest = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(rect, closestSelector)</span> </span>{
        <span class="hljs-keyword">var</span> aspectRatio = rect.width / rect.height;
        <span class="hljs-keyword">var</span> $container = $(<span class="hljs-keyword">this</span>).closest(closestSelector);
        <span class="hljs-keyword">var</span> containerHeight = $container.height();
        <span class="hljs-keyword">var</span> containerWidth = $container.width();
        <span class="hljs-keyword">var</span> containerAspectRatio = containerWidth / containerHeight;
        <span class="hljs-keyword">var</span> scale;
        <span class="hljs-keyword">var</span> margin = <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>The container is skinnier than the image so we need to move the image to the left</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (containerAspectRatio &lt; aspectRatio) {
            scale = <span class="hljs-built_in">Math</span>.round(aspectRatio / containerAspectRatio * <span class="hljs-number">100</span>);

            <span class="hljs-keyword">if</span> (scale &gt; <span class="hljs-number">100</span>) {
                margin = <span class="hljs-built_in">Math</span>.round((scale - <span class="hljs-number">100</span>) / <span class="hljs-number">2</span>);
            }

            <span class="hljs-keyword">return</span> {
                <span class="hljs-string">"margin-top"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"margin-left"</span>: -margin + <span class="hljs-string">"%"</span>,
                <span class="hljs-string">"width"</span>: scale + <span class="hljs-string">"%"</span>
            };
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>The container is fatter than the image so we need to move the image up</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">else</span> {
            scale = <span class="hljs-built_in">Math</span>.round(containerAspectRatio / aspectRatio * <span class="hljs-number">100</span>);

            <span class="hljs-keyword">if</span> (scale &gt; <span class="hljs-number">100</span>) {
                margin = <span class="hljs-built_in">Math</span>.round((scale - <span class="hljs-number">100</span>) / <span class="hljs-number">2</span>);
            }

            <span class="hljs-keyword">return</span> {
                <span class="hljs-string">"margin-left"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"margin-top"</span>: -margin + <span class="hljs-string">"%"</span>,
                <span class="hljs-string">"width"</span>: <span class="hljs-string">"100%"</span>
            };
        }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Scales and resizes an image DOM element so that it fits and is centered in a box with the specified width
and height. 
src: The URL of the image to load
boundingBox: A rectangle with the maximum width and height
callback: Optional callback once image has been resized</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $.fn.fitToBoundingBox = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(src, boundingBox, callback, error)</span> </span>{
        <span class="hljs-keyword">this</span>.each(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">var</span> img = <span class="hljs-keyword">this</span>;

            <span class="hljs-keyword">var</span> callbackWrapper = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(size)</span> </span>{
                <span class="hljs-keyword">var</span> boundedSize = $.fitToBoundingBox(size, boundingBox);
                $(img).css(boundedSize);

                <span class="hljs-keyword">if</span> (callback) {
                    callback.call(img, boundedSize);
                }
            };

            $.naturalSize(src, callbackWrapper, error);
        });

        <span class="hljs-keyword">this</span>.attr(<span class="hljs-string">"src"</span>, src);

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>; <span class="hljs-comment">// TODO can this return a promise?</span>
    };

    $.fitToBoundingBox = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(rect, boundingBox)</span> </span>{
        <span class="hljs-keyword">var</span> aspectRatio = rect.width / rect.height;
        <span class="hljs-keyword">return</span> $.rectWithAspectRatio(boundingBox, aspectRatio);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Preloads the specified image and calls back the specified function 
with a size (width/height) representing the intrinsic size of the image.
src: The URL of the image to load
success: A function that takes a size object as its only argument
error: A function will be called if there is an error loading the image.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $.naturalSize = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(src, success, error)</span> </span>{
        <span class="hljs-keyword">var</span> deferred = <span class="hljs-keyword">new</span> $.Deferred();

        <span class="hljs-keyword">var</span> img = <span class="hljs-keyword">new</span> Image();

        <span class="hljs-keyword">var</span> successWrapper = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>HACK for IE7- With images that are cached, IE7
fires image load events synchronously in the .src setter.
The setter blocks while the onload event handlers execute, which can cause
strange behavior in the caller of this method.
Simulate behavior of other browsers by manually queuing the callback.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-built_in">window</span>.setTimeout(
                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                    <span class="hljs-keyword">var</span> size = {
                        width: img.width,
                        height: img.height
                    };

                    deferred.resolveWith(<span class="hljs-keyword">this</span>, [size]);

                    <span class="hljs-keyword">if</span> (success) {
                        success(size);
                    }
                },
                <span class="hljs-number">0</span>);
        };

        img.onload = successWrapper;
        img.onerror = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> </span>{
            deferred.reject(e);

            <span class="hljs-keyword">if</span> (error) {
                error(e);
            }
        };

        img.src = src;

        <span class="hljs-keyword">return</span> deferred.promise();
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Finds the maximum rectangle size that can fit in the specified container rectangle
using the specified aspect ratio.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $.rectWithAspectRatio = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(containerRect, aspectRatio)</span> </span>{
        <span class="hljs-keyword">var</span> rect = {
            top: <span class="hljs-number">0</span>,
            left: <span class="hljs-number">0</span>,
            width: containerRect.width,
            height: containerRect.height
        };

        <span class="hljs-keyword">var</span> containerAspectRatio = containerRect.width / containerRect.height;

        <span class="hljs-keyword">if</span> (containerAspectRatio &lt; aspectRatio) {
            rect.height = <span class="hljs-built_in">Math</span>.round(rect.width / aspectRatio);
        } <span class="hljs-keyword">else</span> {
            rect.width = <span class="hljs-built_in">Math</span>.round(rect.height * aspectRatio);
        }

        rect.left = (containerRect.width - rect.width) / <span class="hljs-number">2</span>;
        rect.top = (containerRect.height - rect.height) / <span class="hljs-number">2</span>;
        rect.right = rect.left + rect.width;
        rect.bottom = rect.top + rect.height;

        <span class="hljs-keyword">return</span> rect;
    };

})(jQuery);</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>

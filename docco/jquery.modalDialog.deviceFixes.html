<!DOCTYPE html>

<html>
<head>
  <title>jquery.modalDialog.deviceFixes.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="breakpoints.html">
                breakpoints.js
              </a>
            
              
              <a class="source" href="date-parse.html">
                date-parse.js
              </a>
            
              
              <a class="source" href="jquery.breakpoints.html">
                jquery.breakpoints.js
              </a>
            
              
              <a class="source" href="jquery.calcRestrainedPos.html">
                jquery.calcRestrainedPos.js
              </a>
            
              
              <a class="source" href="jquery.clientRect.html">
                jquery.clientRect.js
              </a>
            
              
              <a class="source" href="jquery.contentSize.html">
                jquery.contentSize.js
              </a>
            
              
              <a class="source" href="jquery.cookies.html">
                jquery.cookies.js
              </a>
            
              
              <a class="source" href="jquery.css.html">
                jquery.css.js
              </a>
            
              
              <a class="source" href="jquery.customEvent.html">
                jquery.customEvent.js
              </a>
            
              
              <a class="source" href="jquery.delimitedString.html">
                jquery.delimitedString.js
              </a>
            
              
              <a class="source" href="jquery.disableEvent.html">
                jquery.disableEvent.js
              </a>
            
              
              <a class="source" href="jquery.hostIframe.html">
                jquery.hostIframe.js
              </a>
            
              
              <a class="source" href="jquery.hoverDelay.html">
                jquery.hoverDelay.js
              </a>
            
              
              <a class="source" href="jquery.htmlEncode.html">
                jquery.htmlEncode.js
              </a>
            
              
              <a class="source" href="jquery.imageSize.html">
                jquery.imageSize.js
              </a>
            
              
              <a class="source" href="jquery.isVisibleKeyCode.html">
                jquery.isVisibleKeyCode.js
              </a>
            
              
              <a class="source" href="jquery.menu.html">
                jquery.menu.js
              </a>
            
              
              <a class="source" href="jquery-menu-exampleskin.html">
                jquery-menu-exampleskin.js
              </a>
            
              
              <a class="source" href="jquery.modalDialog.deviceFixes.html">
                jquery.modalDialog.deviceFixes.js
              </a>
            
              
              <a class="source" href="jquery.modalDialog.getSettings.html">
                jquery.modalDialog.getSettings.js
              </a>
            
              
              <a class="source" href="jquery.modalDialog.header.html">
                jquery.modalDialog.header.js
              </a>
            
              
              <a class="source" href="jquery.modalDialog.history.html">
                jquery.modalDialog.history.js
              </a>
            
              
              <a class="source" href="jquery.modalDialog.html">
                jquery.modalDialog.js
              </a>
            
              
              <a class="source" href="jquery.modalDialog.unobtrusive.html">
                jquery.modalDialog.unobtrusive.js
              </a>
            
              
              <a class="source" href="jquery.modalDialog.userAgent.html">
                jquery.modalDialog.userAgent.js
              </a>
            
              
              <a class="source" href="jquery.modalDialogContent.header.html">
                jquery.modalDialogContent.header.js
              </a>
            
              
              <a class="source" href="jquery.modalDialogContent.html">
                jquery.modalDialogContent.js
              </a>
            
              
              <a class="source" href="jquery.msAjax.html">
                jquery.msAjax.js
              </a>
            
              
              <a class="source" href="jquery.noPageScroll.html">
                jquery.noPageScroll.js
              </a>
            
              
              <a class="source" href="jquery.ns.html">
                jquery.ns.js
              </a>
            
              
              <a class="source" href="jquery.partialLoad.html">
                jquery.partialLoad.js
              </a>
            
              
              <a class="source" href="jquery.postMessage.html">
                jquery.postMessage.js
              </a>
            
              
              <a class="source" href="jquery.proxyAll.html">
                jquery.proxyAll.js
              </a>
            
              
              <a class="source" href="jquery.queryString.html">
                jquery.queryString.js
              </a>
            
              
              <a class="source" href="jquery.richTooltip.html">
                jquery.richTooltip.js
              </a>
            
              
              <a class="source" href="jquery.scrollAnchor.html">
                jquery.scrollAnchor.js
              </a>
            
              
              <a class="source" href="jquery.uncomment.html">
                jquery.uncomment.js
              </a>
            
              
              <a class="source" href="jquery.url.html">
                jquery.url.js
              </a>
            
              
              <a class="source" href="pointy.gestures.html">
                pointy.gestures.js
              </a>
            
              
              <a class="source" href="pointy.html">
                pointy.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>jquery.modalDialog.deviceFixes.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>iOS
iOS has a bug where text fields in an iFrame misbehave if there are touch events assigned to the 
host window. This fix disables them while iFrame dialogs are open.</p>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Android
Older versions of Android stock browser, particularly ones whose manufacturers customized the browser
with proprietary text field overlays, have trouble with complex positioning and transforms.
This becomes exacerbated by the complexity of the modal dialog DOM, especially when an IFrame 
is involved.
The result is that the proprietary text field overlays are positioned incorrectly (best case),
or that they start producing nonsensical focus events, which cause the browser to scroll wildly.
<a href="http://stackoverflow.com/questions/8860914/on-android-browser-the-whole-page-jumps-up-and-down-when-typing-inside-a-textbo">http://stackoverflow.com/questions/8860914/on-android-browser-the-whole-page-jumps-up-and-down-when-typing-inside-a-textbo</a></p>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Newer android browsers (4+) support the CSS property: -webkit-user-modify: read-write-plaintext-only;
This will prevent the proprietary text field overlay from showing (though also HTML5 custom ones, such as email keyboards).
<a href="http://stackoverflow.com/questions/9423101/disable-android-browsers-input-overlays">http://stackoverflow.com/questions/9423101/disable-android-browsers-input-overlays</a>
<a href="https://code.google.com/p/android/issues/detail?id=30964">https://code.google.com/p/android/issues/detail?id=30964</a></p>

            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>To work around this problem in older Android (2.3), we have to hide elements that have any CSS transforms.
The cleanest way is to remove ALL content in the DOM in the main panel. This will make the screen behind the dialog turn
completely gray, which isn’t a big deal- many dialog frameworks do this anyway.
To do this, add the attribute to the element:
data-dialog-main-panel=”true”</p>

            </div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Otherwise, you can hide specific problematic elements by adding this attribute:
data-dialog-hide-onopen=”true”</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">($)</span> </span>{
    <span class="hljs-keyword">var</span> SELECTOR_MAIN_PANEL = <span class="hljs-string">"[data-dialog-main-panel='true']"</span>;
    <span class="hljs-keyword">var</span> SELECTOR_BAD_ELEMENT = <span class="hljs-string">"[data-dialog-hide-onopen='true']"</span>;

    <span class="hljs-keyword">var</span> preventWindowTouchEvents = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(dialog, fix)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>The bug only affects iFrame dialogs</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (dialog.dialogType != <span class="hljs-string">"iframe"</span>) {
            <span class="hljs-keyword">return</span>;
        }

        $([<span class="hljs-built_in">window</span>, <span class="hljs-built_in">document</span>]).enableEvent(<span class="hljs-string">"touchmove touchstart touchend"</span>, !fix);
    };

    <span class="hljs-keyword">var</span> getWindowHeight = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">window</span>.innerHeight || $(<span class="hljs-built_in">window</span>).height();
    };

    <span class="hljs-keyword">var</span> initializeShimming = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>First, see if the main panel is specified.
If so, it’s the best choice of elements to hide.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> $badEls = $(SELECTOR_MAIN_PANEL);
        <span class="hljs-keyword">if</span> ($badEls.length === <span class="hljs-number">0</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Otherwise, look for individually marked bad elements to hide.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            $badEls = $(SELECTOR_BAD_ELEMENT);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Cache original values to restore when the dialog closes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> _scrollTop = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">var</span> _height = <span class="hljs-number">0</span>;

        $.modalDialog.onbeforeopen.add(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.level === <span class="hljs-number">0</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Cache scroll height and body height so we can restore them when the dialog is closed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                _scrollTop = $(<span class="hljs-built_in">document</span>).scrollTop();
                _height = <span class="hljs-built_in">document</span>.body.style.height;</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Cache the parent for each element we need to remove from the DOM.
This is important to fix the various WebKit text overlay bugs (described above in the header).
Hiding them wont do it.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                $badEls.each(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(i, el)</span> </span>{
                    $(el).data(<span class="hljs-string">"dialog-parent"</span>, el.parentNode);
                })
                    .detach();</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>HACK: setting the body to be larger than the screen height prevents the address bar from showing up in iOS</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-built_in">document</span>.body.style.height = (getWindowHeight() + <span class="hljs-number">50</span>) + <span class="hljs-string">"px"</span>;

                <span class="hljs-built_in">window</span>.scrollTo(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>);
            }
        });

        $.modalDialog.onopen.add(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.level === <span class="hljs-number">0</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Ensure the body/background is bigger than the dialog,
otherwise we see the background “end” above the bottom
of the dialog.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">var</span> height = <span class="hljs-built_in">Math</span>.max(<span class="hljs-keyword">this</span>.$container.height(), getWindowHeight()) + <span class="hljs-number">20</span>;

                <span class="hljs-built_in">document</span>.body.style.height = height + <span class="hljs-string">"px"</span>;
                $(<span class="hljs-string">".dialog-background"</span>).css({
                    height: height
                });

                <span class="hljs-built_in">window</span>.scrollTo(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>);
            }
        });

        $.modalDialog.onclose.add(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.level === <span class="hljs-number">0</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Restore body height, elements, and scroll position</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-built_in">document</span>.body.style.height = _height;

                $badEls.each(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(i, el)</span> </span>{
                    $($(el).data(<span class="hljs-string">"dialog-parent"</span>)).append(el);
                });

                <span class="hljs-built_in">window</span>.scrollTo(<span class="hljs-number">0</span>, _scrollTop);
            }
        });
    };

    $(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">if</span> (!$.modalDialog.isSmallScreen()) {
            <span class="hljs-keyword">return</span>;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>When removing the host window content from the DOM, make the veil opaque to hide it.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $.modalDialog.veilClass = <span class="hljs-string">"dialog-veil-opaque"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>This will run in a content window. They need the events disabled immediately.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> ($.modalDialog &amp;&amp; $.modalDialog._isContent) {
            <span class="hljs-keyword">var</span> dialog = $.modalDialog.getCurrent();
            <span class="hljs-keyword">if</span> (dialog) {
                $(<span class="hljs-built_in">window</span>).on(<span class="hljs-string">"load"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                    preventWindowTouchEvents(dialog, <span class="hljs-literal">true</span>);
                });
            }
        } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>This is for the host window.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            $.modalDialog.onopen.add(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                preventWindowTouchEvents(<span class="hljs-keyword">this</span>, <span class="hljs-literal">true</span>);
            });
            $.modalDialog.onbeforeclose.add(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                preventWindowTouchEvents(<span class="hljs-keyword">this</span>, <span class="hljs-literal">false</span>);
            });

            initializeShimming();
        }
    });

})(jQuery);</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
